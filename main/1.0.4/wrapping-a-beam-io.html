<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talend Component Kit Developer Reference Guide :: Wrapping a Beam I/O</title>
    <link rel="canonical" href="https://talend.github.io/component-runtime/main/1.0.4/wrapping-a-beam-io.html">
    <meta name="generator" content="Talend Component Kit Generator">
<meta name="date" content="2018-07-31T13:25:20.804Z" scheme="YYYY-MM-DDTHH:mm:ss.sssZ">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" integrity="sha256-NuCn4IvuZXdBaFKJOAcsU2Q3ZpwbdFisd5dux4jkQ5w=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/instantsearch.js/2.8.0/instantsearch.min.css" integrity="sha256-vusmcqkVvKdkwoueSJZLlO9y2P+Lp9fN3WwQUV9Uwfw=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/instantsearch.js/2.8.0/instantsearch-theme-algolia.min.css" integrity="sha256-ZqsS4QagZnfArbOyheCO4qVjzzsMbg/WMvf5tLtId/Q=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/idea.min.css" integrity="sha256-rD61BPsgKHzJPyg7vpXaYOw6tMYuY2fz1p9033NYeM8=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@talend/bootstrap-theme@0.200.1/dist/bootstrap.css">
<link rel="stylesheet" href="../../_/css/talend.css">
<link rel="shortcut icon" href="../../_/images/favicon_0.ico" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PSBN"></script>
    <script>dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)};gtag('js',new Date());gtag('config','GTM-PSBN')</script>
  </head>
  <body>
      <header class="global-header">
  <nav class="navbar navbar-default">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">Component Kit  1.0.4</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Versions <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li class="navbar-item version is-current is-latest">
                <a href="index.html">1.0.4</a>
              </li>
              <li class="navbar-item version">
                <a href="../1.0.3/index.html">1.0.3</a>
              </li>
              <li class="navbar-item version">
                <a href="../1.0.2/index.html">1.0.2</a>
              </li>
              <li class="navbar-item version">
                <a href="../1.0.1/index.html">1.0.1</a>
              </li>
              <li class="navbar-item version">
                <a href="../1.0.0/index.html">1.0.0</a>
              </li>
              <li class="navbar-item version">
                <a href="../0.0.12/index.html">0.0.12</a>
              </li>
              <li class="navbar-item version">
                <a href="../0.0.11/index.html">0.0.11</a>
              </li>
              <li class="navbar-item version">
                <a href="../0.0.10/index.html">0.0.10</a>
              </li>
              <li class="navbar-item version">
                <a href="../0.0.9/index.html">0.0.9</a>
              </li>
              <li class="navbar-item version">
                <a href="../0.0.8/index.html">0.0.8</a>
              </li>
              <li class="navbar-item version">
                <a href="../0.0.7/index.html">0.0.7</a>
              </li>
              <li class="navbar-item version">
                <a href="../0.0.6/index.html">0.0.6</a>
              </li>
              <li class="navbar-item version">
                <a href="../0.0.5/index.html">0.0.5</a>
              </li>
              <li class="navbar-item version">
                <a href="../0.0.4/index.html">0.0.4</a>
              </li>
              <li class="navbar-item version">
                <a href="../0.0.3/index.html">0.0.3</a>
              </li>
              <li class="navbar-item version">
                <a href="../0.0.2/index.html">0.0.2</a>
              </li>
              <li class="navbar-item version">
                <a href="../0.0.1/index.html">0.0.1</a>
              </li>
            </ul>
          </li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Repositories <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a class="navbar-item" href="https://github.com/talend/component-api" target="_blank">API</a></li>
              <li><a class="navbar-item" href="https://github.com/talend/component-runtime" target="_blank">Runtime</a></li>
            </ul>
          </li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Community <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a class="navbar-item" href="contributors.html">Contributors</a></li>
              <li><a class="navbar-item" href="https://community.talend.com/t5/Component-Development/bd-p/ComponentDevelopment" target="_blank">Forum</a></li>
            </ul>
          </li>
        </ul>
        <form role="search" action="search.html" class="navbar-form navbar-right">
          <div class="input-group">
            <span class="input-group-addon"><i class="fa fa-search"></i></span>
            <input class="form-control" type="text" placeholder="Search" name="query" id="searchInput">
          </div>
        </form>
      </div>
    </nav>
</header>
            <main class="main">
              <div class="navigation-container grey-background hidden-xs col-sm-2" data-component="main" data-version="1.0.4">
  <aside class="navigation" role="navigation">
    <div class="panels">
      <div class="navigation-menu is-active" data-panel="menu">
        <nav class="nav-menu">
          <!-- <label>Talend Component Kit Developer Reference Guide</label> -->
          <ul class="nav nav-list tree" >
  <li data-depth="0">
      
    <ul class="nav nav-list tree" >
  <li data-depth="1">
      <label class="tree-toggler nav-header"><i class="fa fa-angle-right"></i><span>Getting Started</span></label>
    <ul class="nav nav-list tree"  style="display:none">
  <li data-depth="2">
    <a class="menu-link" href="what-is-a-talend-component.html">What is a Talend Component</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="methodology-creating-components.html">Methodology</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="tck-framework-overview.html">Framework Overview</a>
  </li>
</ul>
  </li>
  <li data-depth="1">
      <label class="tree-toggler nav-header"><i class="fa fa-angle-right"></i><span>Setting up your environment</span></label>
    <ul class="nav nav-list tree"  style="display:none">
  <li data-depth="2">
    <a class="menu-link" href="system-prerequisites.html">System requirements</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="tutorial-talend-intellij-plugin-usage.html">IntelliJ plugin</a>
  </li>
</ul>
  </li>
  <li data-depth="1">
      <label class="tree-toggler nav-header"><i class="fa fa-angle-right"></i><span>Generating a project</span></label>
    <ul class="nav nav-list tree"  style="display:none">
  <li data-depth="2">
    <a class="menu-link" href="tutorial-generate-project-using-starter.html">Using the starter</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="generate-project-using-intellij-plugin.html">Using the IntelliJ plugin</a>
  </li>
</ul>
  </li>
  <li data-depth="1">
      <label class="tree-toggler nav-header"><i class="fa fa-angle-right"></i><span>Creating components</span></label>
    <ul class="nav nav-list tree"  style="display:none">
  <li data-depth="2">
    <a class="menu-link" href="component-definition.html">Defining a component</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="component-configuration.html">Configuring a component</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="component-registering.html">Registering a component</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="component-internationalization.html">Internationalizing a component</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="component-loading.html">Loading a component</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="tutorial-configuration-sensitive-data.html">Masking sensitive data</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="best-practices.html">Best practices</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="index-sub-build-tools.html">Build tools</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="wrapping-a-beam-io.html">Wrapping a Beam I/O</a>
  </li>
</ul>
  </li>
  <li data-depth="1">
      <label class="tree-toggler nav-header"><i class="fa fa-angle-right"></i><span>Defining services</span></label>
    <ul class="nav nav-list tree"  style="display:none">
  <li data-depth="2">
    <a class="menu-link" href="services-internationalization.html">Internationalizing a service</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="services-actions.html">Providing actions through a service</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="services-built-in.html">Built-in services</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="services-interceptors.html">Services and interceptors</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="services-custom-api.html">Defining a custom API</a>
  </li>
</ul>
  </li>
  <li data-depth="1">
      <label class="tree-toggler nav-header"><i class="fa fa-angle-right"></i><span>Testing components</span></label>
    <ul class="nav nav-list tree"  style="display:none">
  <li data-depth="2">
    <a class="menu-link" href="testing-best-practices.html">Component testing best practices</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="index-sub-testing-runtime.html">Testing component runtime</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="testing-beam.html">Beam testing</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="testing-multiple-envs.html">Testing in multiple environments</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="testing-maven-passwords.html">Reusing Maven credentials</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="testing-generating-data.html">Generating data for testing</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="services-pipeline.html">Simple/Test Pipeline API</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="https://beam.apache.org/documentation/programming-guide/#creating-a-pipeline">Beam Pipeline API</a>
  </li>
</ul>
  </li>
  <li data-depth="1">
      <label class="tree-toggler nav-header"><i class="fa fa-angle-right"></i><span>Deploying components</span></label>
    <ul class="nav nav-list tree"  style="display:none">
  <li data-depth="2">
    <a class="menu-link" href="studio.html">Deploying to Talend Studio</a>
  </li>
</ul>
  </li>
  <li data-depth="1">
      <label class="tree-toggler nav-header"><i class="fa fa-angle-right"></i><span>Tutorials</span></label>
    <ul class="nav nav-list tree"  style="display:none">
  <li data-depth="2">
    <a class="menu-link" href="tutorial-generate-project-using-starter.html">Generating a project from the starter</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="tutorial-create-an-input-component.html">Creating a Hazelcast input component</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="tutorial-create-an-output-component.html">Creating a Hazelcast output component</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="tutorial-create-components-rest-api.html">Creating a Zendesk REST API connector</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="tutorial-test-rest-api.html">Testing a Zendesk REST API connector</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="tutorial-test-your-components.html">Testing a Hazelcast component</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="tutorial-dev-vs-ci-setup.html">Testing in a continuous integration environment</a>
  </li>
</ul>
  </li>
  <li data-depth="1">
      <label class="tree-toggler nav-header"><i class="fa fa-angle-right"></i><span>Reference Guide</span></label>
    <ul class="nav nav-list tree"  style="display:none">
  <li data-depth="2">
    <a class="menu-link" href="gallery.html">Widget and validation gallery</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="ref-actions.html">Actions</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="ref-conditions.html">Conditions</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="ref-configuration-types.html">Configuration types</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="ref-constraints.html">Constraints</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="ref-junit-environments.html">Junit environments</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="ref-proxy-server-api.html">Proxy server API</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="ref-proxy-server-configuration.html">Proxy server configuration</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="ref-rest-resources.html">Component Runtime REST resources</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="ref-scanning-exclusions.html">Scanning exclusions</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="ref-server-configuration.html">Server configuration</a>
  </li>
  <li data-depth="2">
    <a class="menu-link" href="ref-ui.html">UI API</a>
  </li>
</ul>
  </li>
  <li data-depth="1">
    <a class="menu-link" href="apidocs.html">Javadocs</a>
  </li>
  <li data-depth="1">
    <a class="menu-link" href="index-knowledge-base.html">Knowledge base</a>
  </li>
  <li data-depth="1">
    <a class="menu-link" href="changelog.html">Changelog</a>
  </li>
</ul>
  </li>
</ul>
        </nav>
      </div>
    </div>
  </aside>
</div>
              <div class="col-xs-12 col-sm-10 maincontent">
                <div class="toolbar" role="navigation">

    <ol class="breadcrumb grey-background">
      <li class="crumb"><a href="index-creating-components.html">Creating components</a></li>
      <li class="crumb active"><a href="wrapping-a-beam-io.html">Wrapping a Beam I/O</a></li>
    </ol>
</div>
                <article class="doc">
        <div class="row">
          <div class="col-sm-9 row">
              <h1>Wrapping a Beam I/O</h1>
            <div class="article-content">
              <div class="sect1">
<h2 id="wrapping-a-beam-io__start"><a class="anchor" href="#wrapping-a-beam-io__start"></a>Limitations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This part is limited to specific kinds of <a href="https://beam.apache.org/">Beam</a> <code>PTransform</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PTransform&lt;PBegin, PCollection&lt;?&gt;&gt;</code> for inputs.</p>
</li>
<li>
<p><code>PTransform&lt;PCollection&lt;?&gt;, PDone&gt;</code> for outputs. Outputs must use a single (composite or not) <code>DoFn</code> in their <code>apply</code> method.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wrapping_an_input"><a class="anchor" href="#_wrapping_an_input"></a>Wrapping an input</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To illustrate the input wrapping, this procedure uses the following input as a starting point (based on existing Beam inputs):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@AutoValue
public abstract [static] class Read extends PTransform&lt;PBegin, PCollection&lt;String&gt;&gt; {

  // config

  @Override
  public PCollection&lt;String&gt; expand(final PBegin input) {
    return input.apply(
        org.apache.beam.sdk.io.Read.from(new BoundedElasticsearchSource(this, null)));
  }

  // ... other transform methods
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To wrap the <code>Read</code> in a framework component, create a transform delegating to that Read with at least a <code>@PartitionMapper</code> annotation and using <code>@Option</code> constructor injections to configure the component. Also make sure to follow the best practices and to specify <code>@Icon</code> and <code>@Version</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@PartitionMapper(family = "myfamily", name = "myname")
public class WrapRead extends PTransform&lt;PBegin, PCollection&lt;String&gt;&gt; {
  private PTransform&lt;PBegin, PCollection&lt;String&gt;&gt; delegate;

  public WrapRead(@Option("dataset") final WrapReadDataSet dataset) {
    delegate = TheIO.read().withConfiguration(this.createConfigurationFrom(dataset));
  }

  @Override
  public PCollection&lt;String&gt; expand(final PBegin input) {
    return delegate.expand(input);
  }

  // ... other methods like the mapping with the native configuration (createConfigurationFrom)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wrapping_an_output"><a class="anchor" href="#_wrapping_an_output"></a>Wrapping an output</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To illustrate the output wrapping, this procedure uses the following output as a starting point (based on existing Beam outputs):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@AutoValue
public abstract [static] class Write extends PTransform&lt;PCollection&lt;String&gt;, PDone&gt; {


    // configuration withXXX(...)

    @Override
    public PDone expand(final PCollection&lt;String&gt; input) {
      input.apply(ParDo.of(new WriteFn(this)));
      return PDone.in(input.getPipeline());
    }

    // other methods of the transform
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can wrap this output exactly the same way you wrap an input, but using <code>@Processor</code> instead of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Processor(family = "myfamily", name = "myname")
public class WrapWrite extends PTransform&lt;PCollection&lt;String&gt;, PDone&gt; {
  private PTransform&lt;PCollection&lt;String&gt;, PDone&gt; delegate;

  public WrapWrite(@Option("dataset") final WrapWriteDataSet dataset) {
    delegate = TheIO.write().withConfiguration(this.createConfigurationFrom(dataset));
  }

  @Override
  public PDone expand(final PCollection&lt;String&gt; input) {
    return delegate.expand(input);
  }

  // ... other methods like the mapping with the native configuration (createConfigurationFrom)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tip"><a class="anchor" href="#_tip"></a>Tip</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Note that the <code>org.talend.sdk.component.runtime.beam.transform.DelegatingTransform</code> class fully delegates the "expansion" to another transform. Therefore, you can extend it and implement the configuration mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Processor(family = "beam", name = "file")
public class BeamFileOutput extends DelegatingTransform&lt;PCollection&lt;String&gt;, PDone&gt; {

    public BeamFileOutput(@Option("output") final String output) {
        super(TextIO.write()
            .withSuffix("test")
            .to(FileBasedSink.convertToFileResourceIfPossible(output)));
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced"><a class="anchor" href="#_advanced"></a>Advanced</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In terms of classloading, when you write an I/O, the Beam SDK Java core stack is assumed as provided in Talend Component Kit runtime. This way, you don&#8217;t need to include it in the compile scope, it would be ignored anyway.</p>
</div>
<div class="sect2">
<h3 id="_coder"><a class="anchor" href="#_coder"></a>Coder</h3>
<div class="paragraph">
<p>If you need a JSonCoder, you can use the <code>org.talend.sdk.component.runtime.beam.factory.service.PluginCoderFactory</code> service,
which gives you access to the JSON-P and JSON-B coders.</p>
</div>
<div class="paragraph">
<p>There is also an Avro coder, which uses the <code>FileContainer</code>. It ensures it
is self-contained for <code>IndexedRecord</code> and it does not require—as the default Apache Beam <code>AvroCoder</code>—to set the schema when creating a pipeline.<br>
It consumes more space and therefore is slightly slower, but it is fine for <code>DoFn</code>, since it does not rely on serialization in most cases.
See <code>org.talend.sdk.component.runtime.beam.transform.avro.IndexedRecordCoder</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jsonobject_to_indexedrecord"><a class="anchor" href="#_jsonobject_to_indexedrecord"></a>JsonObject to IndexedRecord</h3>
<div class="paragraph">
<p>The mainstream model is <code>JsonObject</code> but it is common to have a legacy system using
<code>IndexedRecord</code>. To mitigate the transition, you can use the following <code>PTransforms</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IndexedRecordToJson</code>: to convert an <code>IndexedRecord</code> to a <code>JsonObject</code>.</p>
</li>
<li>
<p><code>JsonToIndexedRecord</code>: to convert a <code>JsonObject</code> to an <code>IndexedRecord</code>.</p>
</li>
<li>
<p><code>SchemalessJsonToIndexedRecord</code>: to convert a <code>JsonObject</code> to an <code>IndexedRecord</code> with AVRO schema inference.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sample"><a class="anchor" href="#_sample"></a>Sample</h3>
<div class="listingblock">
<div class="title">Sample input based on Beam Kafka</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Version
@Icon(Icon.IconType.KAFKA)
@Emitter(name = "Input")
@AllArgsConstructor
@Documentation("Kafka Input")
public class KafkaInput extends PTransform&lt;PBegin, PCollection&lt;JsonObject&gt;&gt; { <i class="conum" data-value="1"></i><b>(1)</b>

    private final InputConfiguration configuration;

    private final JsonBuilderFactory builder;

    private final PluginCoderFactory coderFactory;

    private KafkaIO.Read&lt;byte[], byte[]&gt; delegate() {
        final KafkaIO.Read&lt;byte[], byte[]&gt; read = KafkaIO.&lt;byte[], byte[]&gt; read()
                .withBootstrapServers(configuration.getBootstrapServers())
                .withTopics(configuration.getTopics().stream().map(InputConfiguration.Topic::getName).collect(toList()))
                .withKeyDeserializer(ByteArrayDeserializer.class).withValueDeserializer(ByteArrayDeserializer.class);
        if (configuration.getMaxResults() &gt; 0) {
            return read.withMaxNumRecords(configuration.getMaxResults());
        }
        return read;
    }

    @Override <i class="conum" data-value="2"></i><b>(2)</b>
    public PCollection&lt;JsonObject&gt; expand(final PBegin pBegin) {
        final PCollection&lt;KafkaRecord&lt;byte[], byte[]&gt;&gt; kafkaEntries = pBegin.getPipeline().apply(delegate());
        return kafkaEntries.apply(ParDo.of(new RecordToJson(builder))).setCoder(coderFactory.jsonp()); <i class="conum" data-value="3"></i><b>(3)</b>
    }

    @AllArgsConstructor
    private static class RecordToJson extends DoFn&lt;KafkaRecord&lt;byte[], byte[]&gt;, JsonObject&gt; {

        private final JsonBuilderFactory builder;

        @ProcessElement
        public void onElement(final ProcessContext context) {
            context.output(toJson(context.element()));
        }

        private JsonObject toJson(final KafkaRecord&lt;byte[], byte[]&gt; element) {
            return builder.createObjectBuilder().add("key", new String(element.getKV().getKey()))
                    .add("value", new String(element.getKV().getValue())).build();
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>PTransform</code> generics define that the component is an input (<code>PBegin</code> marker).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>expand</code> method chains the native I/O with a custom mapper (<code>RecordToJson</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The mapper uses the JSON-P coder automatically created from the contextual component.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Because the Beam wrapper does not respect the standard Talend Component Kit programming model ( for example, there is no <code>@Emitter</code>), you need to set the <code>&lt;talend.validation.component&gt;false&lt;/talend.validation.component&gt;</code> property in your <code>pom.xml</code> file (or equivalent for Gradle) to skip the component programming model validations of the framework.</p>
</div>
</div>
</div>
</div>
<div class="sect1 relatedlinks">
<h2 id="_related_articles"><a class="anchor" href="#_related_articles"></a>Related articles</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="component-definition.html" class="page">Defining a component</a></p>
</li>
<li>
<p><a href="services-pipeline.html" class="page">Creating a job pipeline</a></p>
</li>
<li>
<p><a href="testing-beam.html" class="page">Beam testing</a></p>
</li>
<li>
<p><a href="testing-multiple-envs.html" class="page">Testing in multiple environments</a></p>
</li>
</ul>
</div>
</div>
</div>
            </div>
          </div>
          <div class="col-sm-3 container article-side-panel">
            <nav class="article-anchors">
              <h1>On this page</h1>
            </nav>
          </div>
          <a href="#top" class="top">Scroll to top</a>
        </div>
        <script>(window.talend = (window.talend || {})).article = true;</script>
    </article>
              </div>
            </main>
      </main>
      <footer class="footer ">
    <div class="footer-with-copyright footer-with-links">
        <ul class="footer-links" style="">
            <li><a class="gwt-Anchor" href="http://www.talend.com/">Talend</a></li>
            <li><a class="gwt-Anchor" href="http://www.talend.com/contact">Contact</a></li>
            <li><a class="gwt-Anchor" href="http://www.talend.com/legal-terms/us-eula">Talend EULA</a></li>
        </ul>
        <div class="footer-copyright" style="">&copy; 2018 Talend Inc. All rights reserved.</div>
    </div>
</footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
<script src="https://cdn.rawgit.com/rmannibucau/00206484a54ac569e091513e6d2a1c01/raw/46cd5d77ba1abe678f83d11490e12a327b62d7ee/anchorific.js"></script>
<script src="../../_/js/talend.js"></script>
  </body>
</html>
