
<!DOCTYPE html>

<html lang="en">
  <head>
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111939683-1"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-111939683-1');
      </script>

    <meta charset="utf-8">
    <title>Talend Component Documentation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="date" content="2018-01-16 13:28:55" scheme="YYYY-MM-dd HH:mm:ss">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="stylesheet" href="css/bootstrap.css" media="screen">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ink/3.1.0/css/font-awesome.min.css" integrity="sha256-MUe1D3T3ocGLZQ2h8wgpcIz5BoTu1OZo8q0BjK5u/o0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.min.css" />
    <!--[if lt IE 9]>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.ie.min.css" />
    <![endif]-->
    <link rel="stylesheet" href="css/documentation.css">
    <link rel="shortcut icon" href="images/favicon_0.ico" />
    <style>
    body{padding-top:50px}body>.navbar{-webkit-transition:background-color .3s ease-in;transition:background-color .3s ease-in}@media (min-width:768px){body>.navbar-transparent{background-color:transparent}body>.navbar-transparent .navbar-nav>.open>a{background-color:transparent!important}}#home{padding-top:0}#home .navbar-brand{padding:13.5px 15px 12.5px}#home .navbar-brand>img{display:inline;margin:0 10px;height:100%}#banner{min-height:300px;border-bottom:none}.table-of-contents{margin-top:1em}.page-header h1{font-size:4em}.bs-docs-section{margin-top:6em}.bs-docs-section h1{padding-top:100px}.bs-component{position:relative}.bs-component .modal{position:relative;top:auto;right:auto;left:auto;bottom:auto;z-index:1;display:block}.bs-component .modal-dialog{width:90%}.bs-component .popover{position:relative;display:inline-block;width:220px;margin:20px}#source-button{position:absolute;top:0;right:0;z-index:100;font-weight:700}.progress{margin-bottom:10px}footer{margin:5em 0}footer li{float:left;margin-right:1.5em;margin-bottom:1.5em}footer p{clear:left;margin-bottom:0}.splash{padding:9em 0 2em;background-color:#141d27;background-image:url(../img/bg.jpg);background-size:cover;background-attachment:fixed;color:#fff;text-align:center}.splash .logo{width:160px}.splash h1{font-size:3em}.splash #social{margin:2em 0}.splash .alert{margin:2em 0}.section-tout{padding:4em 0 3em;border-bottom:1px solid rgba(0,0,0,.05);background-color:#eaf1f1}.section-tout .fa{margin-right:.5em}.section-tout p{margin-bottom:3em}.section-preview{padding:4em 0 4em}.section-preview .preview{margin-bottom:4em;background-color:#eaf1f1}.section-preview .preview .image{position:relative}.section-preview .preview .image:before{box-shadow:inset 0 0 0 1px rgba(0,0,0,.1);position:absolute;top:0;left:0;width:100%;height:100%;content:"";pointer-events:none}.section-preview .preview .options{padding:1em 2em 2em;border:1px solid rgba(0,0,0,.05);border-top:none;text-align:center}.section-preview .preview .options p{margin-bottom:2em}.section-preview .dropdown-menu{text-align:left}.section-preview .lead{margin-bottom:2em}@media (max-width:767px){.section-preview .image img{width:100%}}.sponsor #carbonads{max-width:240px;margin:0 auto}.sponsor .carbon-text{display:block;margin-top:1em;font-size:12px}.sponsor .carbon-poweredby{float:right;margin-top:1em;font-size:10px}@media (max-width:767px){.splash{padding-top:4em}.splash .logo{width:100px}.splash h1{font-size:2em}#banner{margin-bottom:2em;text-align:center}}
    </style>
  </head>
  <body>
    <a class="github-fork-ribbon" target="_blank"
        href="https://github.com/talend/component-runtime" data-ribbon="Fork me on GitHub"
        title="Fork me on GitHub">Fork me on GitHub</a>
    <div class="col-sm-offset-1 col-sm-10">

	
<div class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <a href="/component-runtime/index.html" class="navbar-brand">Component Kit</a>
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div class="navbar-collapse collapse" id="navbar-main">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="entries">Documentation <span class="caret"></span></a>
          <ul class="dropdown-menu" aria-labelledby="entries">
            <li><a href="/component-runtime/index.html">Home</a></li>
            <li><a href="documentation-overview.html">Overview</a></li>
            <li><a href="getting-started.html">Getting Started</a></li>
            <li><a href="documentation.html">Reference</a></li>
            <li><a href="best-practices.html">Best Practices</a></li>
            <li><a href="documentation-testing.html">Testing</a></li>
            <li><a href="documentation-rest.html">REST API</a></li>
            <li><a href="wrapping-a-beam-io.html">How to wrap a Beam I/O</a></li>
            <li><a href="studio.html">Studio Integration</a></li>
            <li><a href="changelog.html">Changelog</a></li>
            <li><a href="contributors.html">Wall of Fame</a></li>
            <li><a href="apidocs.html">API Documentation</a></li>
            <li><a href="appendix.html">Appendix</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="versions">Versions <span class="caret"></span></a>
          <ul class="dropdown-menu" aria-labelledby="versions">
            <li><a href="/component-runtime/index.html">Current</a></li>
            <li><a href="/component-runtime/latest/index.html">Latest</a></li>
            
          </ul>
        </li>
      </ul>
    </div>
  </div>
</div>


    <div class="container section-padded">
        <div class="row title">
            <div class='page-header'>
              <h2>Talend Component Documentation Testing</h2>
            </div>
        </div>
        <div class="row">
            
            <div class="col-md-12">
                <div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#documentation-testing-start">1. Best practises</a>
<ul class="sectlevel2">
<li><a href="#_parameterized_tests">1.1. Parameterized tests</a></li>
</ul>
</li>
<li><a href="#_component_runtime_testing">2. component-runtime-testing</a>
<ul class="sectlevel2">
<li><a href="#_component_runtime_junit">2.1. component-runtime-junit</a></li>
<li><a href="#_component_runtime_testing_spark">2.2. component-runtime-testing-spark</a></li>
<li><a href="#_component_runtime_http_junit">2.3. component-runtime-http-junit</a></li>
</ul>
</li>
<li><a href="#_beam_testing">3. Beam testing</a></li>
<li><a href="#_multiple_environments_for_the_same_tests">4. Multiple environments for the same tests</a>
<ul class="sectlevel2">
<li><a href="#_junit_4_5">4.1. JUnit 4</a></li>
<li><a href="#_junit_5_5">4.2. JUnit 5</a></li>
<li><a href="#_provided_environments">4.3. Provided environments</a></li>
<li><a href="#_configuring_environments">4.4. Configuring environments</a></li>
</ul>
</li>
<li><a href="#_secrets_passwords_and_maven">5. Secrets/Passwords and Maven</a></li>
<li><a href="#_generating_data">6. Generating data?</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="documentation-testing-start">1. Best practises</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
this part is mainly around tools usable with JUnit. You can use most of these techniques with TestNG
as well, check out the documentation if you need to use TestNG.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_parameterized_tests">1.1. Parameterized tests</h3>
<div class="paragraph">
<p>This is a great solution to repeat the same test multiple times. Overall idea
is to define a test scenario (<code>I test function F</code>) and to make the input/output data
dynamic.</p>
</div>
<div class="sect3">
<h4 id="_junit_4">1.1.1. JUnit 4</h4>
<div class="paragraph">
<p>Here is an example. Let&#8217;s assume we have this test which validates the connection URI using <code>ConnectionService</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyConnectionURITest</span> {
    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> checkMySQL() {
        assertTrue(<span style="color:#080;font-weight:bold">new</span> ConnectionService().isValid(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jdbc:mysql://localhost:3306/mysql</span><span style="color:#710">&quot;</span></span>));
    }

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> checkOracle() {
        assertTrue(<span style="color:#080;font-weight:bold">new</span> ConnectionService().isValid(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jdbc:oracle:thin:@//myhost:1521/oracle</span><span style="color:#710">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We clearly identify the test method is always the same except the value. It can therefore be rewritter
using JUnit <code>Parameterized</code> runner like that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@RunWith</span>(Parameterized.class) <i class="conum" data-value="1"></i><b>(1)</b>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyConnectionURITest</span> {

    <span style="color:#007">@Parameterized</span>.Parameters(name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">{0}</span><span style="color:#710">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#0a8;font-weight:bold">Iterable</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; uris() { <i class="conum" data-value="3"></i><b>(3)</b>
        <span style="color:#080;font-weight:bold">return</span> asList(
            <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jdbc:mysql://localhost:3306/mysql</span><span style="color:#710">&quot;</span></span>,
            <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jdbc:oracle:thin:@//myhost:1521/oracle</span><span style="color:#710">&quot;</span></span>);
    }

    <span style="color:#007">@Parameterized</span>.Parameter <i class="conum" data-value="4"></i><b>(4)</b>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> uri;

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> isValid() { <i class="conum" data-value="5"></i><b>(5)</b>
        assertNotNull(uri);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Parameterized</code> is the runner understanding <code>@Parameters</code> and how to use it. Note that you can generate random data here if desired.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>by default the name of the executed test is the index of the data, here we customize it using the first parameter <code>toString()</code> value to have something more readable</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the <code>@Parameters</code> method <code>MUST</code> be static and return an array or iterable of the data used by the tests</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>you can then inject the current data using <code>@Parameter</code> annotation, it can take a parameter if you use an array of array instead of an iterable of object in <code>@Parameterized</code> and you can select which item you want injected this way</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the <code>@Test</code> method will be executed using the contextual data, in this sample we&#8217;ll get executed twice with the 2 specified urls</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
you don&#8217;t have to define a single <code>@Test</code> method, if you define multiple, each of them will be executed with all the data (ie if we add a test in previous example you will get 4 tests execution - 2 per data, ie 2x2)
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_junit_5">1.1.2. JUnit 5</h4>
<div class="paragraph">
<p>JUnit 5 reworked this feature to make it way easier to use. The full documentation is available at <a href="http://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests" class="bare">junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests</a>.</p>
</div>
<div class="paragraph">
<p>The main difference is you can also define inline on the test method that it is a parameterized test and which are the values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ParameterizedTest</span>
<span style="color:#007">@ValueSource</span>(strings = { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">racecar</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">radar</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">able was I ere I saw elba</span><span style="color:#710">&quot;</span></span> })
<span style="color:#339;font-weight:bold">void</span> mytest(<span style="color:#0a8;font-weight:bold">String</span> currentValue) {
    <span style="color:#777">// do test</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However you can still use the previous behavior using a method binding configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ParameterizedTest</span>
<span style="color:#007">@MethodSource</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">stringProvider</span><span style="color:#710">&quot;</span></span>)
<span style="color:#339;font-weight:bold">void</span> mytest(<span style="color:#0a8;font-weight:bold">String</span> currentValue) {
    <span style="color:#777">// do test</span>
}

<span style="color:#088;font-weight:bold">static</span> Stream&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; stringProvider() {
    <span style="color:#080;font-weight:bold">return</span> Stream.of(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">foo</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bar</span><span style="color:#710">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This last option allows you to inject any type of value - not only primitives - which is very common to define scenarii.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
don&#8217;t forget to add <code>junit-jupiter-params</code> dependency to benefit from this feature.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_component_runtime_testing">2. component-runtime-testing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_component_runtime_junit">2.1. component-runtime-junit</h3>
<div class="paragraph">
<p><code>component-runtime-junit</code> is a small test library allowing you to validate simple logic based on Talend Component tooling.</p>
</div>
<div class="paragraph">
<p>To import it add to your project the following dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>component-runtime-junit<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${talend-component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;scope&gt;</span>test<span style="color:#070;font-weight:bold">&lt;/scope&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_junit_4_2">2.1.1. JUnit 4</h4>
<div class="paragraph">
<p>Then you can define a standard JUnit test and use the <code>SimpleComponentRule</code> rule:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyComponentTest</span> {

    <span style="color:#007">@Rule</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">final</span> SimpleComponentRule components = <span style="color:#080;font-weight:bold">new</span> SimpleComponentRule(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component.mycomponent.</span><span style="color:#710">&quot;</span></span>);

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> produce() {
        ExecutionChainBuilder.start() <i class="conum" data-value="2"></i><b>(2)</b>
                .fromInput(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">yourcomponentfamily</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">yourcomponent</span><span style="color:#710">&quot;</span></span>, createComponentConfig())
                .toProcessor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">test</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">collector</span><span style="color:#710">&quot;</span></span>, emptyMap())
                .create(components.asManager(), p -&gt; <span style="color:#069">null</span>, Assert::assertNotNull, (data, exception) -&gt; {
                    fail(exception.getMessage());
                    <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">null</span>;
                }).get().execute();

        <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;MyRecord&gt; records = components.getCollectedData(MyRecord.class); <i class="conum" data-value="3"></i><b>(3)</b>
        doAssertRecords(records); <span style="color:#777">// depending your test</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the rule will create a component manager and provide two mock components: an emitter and a collector. Don&#8217;t forget to set the root package of your component to enable it.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>you define any chain you want to test, it generally uses the mock as source or collector</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>you validate your component behavior, for a source you can assert the right records were emitted in the mock collect</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_junit_5_2">2.1.2. JUnit 5</h4>
<div class="paragraph">
<p>The JUnit 5 integration is mainly the same as for JUnit 4 except it uses the new JUnit 5 extension mecanism.</p>
</div>
<div class="paragraph">
<p>The entry point is the <code>@WithComponents</code> annotation you put on your test class which takes the
component package you want to test and you can use <code>@Injected</code> to inject in a test class field an instance of <code>ComponentsHandler</code>
which exposes the same utilities than the JUnit 4 rule:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@WithComponents</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component.junit.component</span><span style="color:#710">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">ComponentExtensionTest</span> {
    <span style="color:#007">@Injected</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span style="color:#088;font-weight:bold">private</span> ComponentsHandler handler;

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> manualMapper() {
        <span style="color:#088;font-weight:bold">final</span> Mapper mapper = handler.createMapper(<span style="color:#0a8;font-weight:bold">Source</span>.class, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Source</span>.Config() {

            {
                values = asList(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">b</span><span style="color:#710">&quot;</span></span>);
            }
        });
        assertFalse(mapper.isStream());
        <span style="color:#088;font-weight:bold">final</span> Input input = mapper.create();
        assertEquals(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a</span><span style="color:#710">&quot;</span></span>, input.next());
        assertEquals(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">b</span><span style="color:#710">&quot;</span></span>, input.next());
        assertNull(input.next());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The annotation defines which components to register in the test context.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The field allows to get the handler to be able to orchestrate the tests.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if it is the first time you use JUnit 5, don&#8217;t forget the imports changed and you must use <code>org.junit.jupiter.api.Test</code> instead of <code>org.junit.Test</code>.
Some IDE versions and <code>surefire</code> versions can also need you to install either a plugin or a specific configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_mocking_the_output">2.1.3. Mocking the output</h4>
<div class="paragraph">
<p>Using the component "test"/"collector" as in previous sample stores all records emitted by the chain (typically your source)
in memory, you can then access them using <code>theSimpleComponentRule.getCollectoedRecord(type)</code>. Note that this method filters by type,
if you don&#8217;t care of the type just use <code>Object.class</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mocking_the_input">2.1.4. Mocking the input</h4>
<div class="paragraph">
<p>The input mocking is symmetric to the output but here you provide the data you want to inject:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyComponentTest</span> {

    <span style="color:#007">@Rule</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">final</span> SimpleComponentRule components = <span style="color:#080;font-weight:bold">new</span> SimpleComponentRule(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component.mycomponent.</span><span style="color:#710">&quot;</span></span>);

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> produce() {
        components.setInputData(asList(createData(), createData(), createData())); <i class="conum" data-value="1"></i><b>(1)</b>

        ExecutionChainBuilder.start() <i class="conum" data-value="2"></i><b>(2)</b>
                .fromInput(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">test</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">emitter</span><span style="color:#710">&quot;</span></span>, emptyMap())
                .toProcessor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">yourcomponentfamily</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">myoutput</span><span style="color:#710">&quot;</span></span>, createComponentConfig())
                .create(components.asManager(), p -&gt; <span style="color:#069">null</span>, Assert::assertNotNull, (data, exception) -&gt; {
                    fail(exception.getMessage());
                    <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">null</span>;
                }).get().execute();

        assertMyOutputProcessedTheInputData();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>using <code>setInputData</code> you prepare the execution(s) to have a fake input when using "test"/"emitter" component.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_creating_runtime_configuration_from_component_configuration">2.1.5. Creating runtime configuration from component configuration</h4>
<div class="paragraph">
<p>The component configuration is a POJO (using <code>@Option</code> on fields) and the runtime configuration (<code>ExecutionChainBuilder</code>) uses
a <code>Map&lt;String, String&gt;</code>. To make the conversion easier, the JUnit integration provides a <code>SimpleFactory.configurationByExample</code> utility
to get this map instance from a configuration instance.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">final</span> MyComponentConfig componentConfig = <span style="color:#080;font-weight:bold">new</span> MyComponentConfig();
componentConfig.setUser(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">....</span><span style="color:#710">&quot;</span></span>);
<span style="color:#777">// .. other inits</span>

<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; configuration = configurationByExample(componentConfig);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_a_mapper">2.1.6. Testing a Mapper</h4>
<div class="paragraph">
<p>The <code>SimpleComponentRule</code> also allows to test a mapper unitarly, you can get an instance from a configuration
and you can execute this instance to collect the output. Here is a snippet doing that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MapperTest</span> {

    <span style="color:#007">@ClassRule</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> SimpleComponentRule COMPONENT_FACTORY = <span style="color:#080;font-weight:bold">new</span> SimpleComponentRule(
            <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.company.talend.component</span><span style="color:#710">&quot;</span></span>);

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> mapper() {
        <span style="color:#088;font-weight:bold">final</span> Mapper mapper = COMPONENT_FACTORY.createMapper(MyMapper.class, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Source</span>.Config() {{
            values = asList(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">b</span><span style="color:#710">&quot;</span></span>);
        }});
        assertEquals(asList(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">b</span><span style="color:#710">&quot;</span></span>), COMPONENT_FACTORY.collectAsList(<span style="color:#0a8;font-weight:bold">String</span>.class, mapper));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_a_processor">2.1.7. Testing a Processor</h4>
<div class="paragraph">
<p>As for the mapper a processor is testable unitary. The case is a bit more complex since you can have multiple
inputs and outputs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">ProcessorTest</span> {

    <span style="color:#007">@ClassRule</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> SimpleComponentRule COMPONENT_FACTORY = <span style="color:#080;font-weight:bold">new</span> SimpleComponentRule(
            <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.company.talend.component</span><span style="color:#710">&quot;</span></span>);

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> processor() {
        <span style="color:#088;font-weight:bold">final</span> Processor processor = COMPONENT_FACTORY.createProcessor(Transform.class, <span style="color:#069">null</span>);
        <span style="color:#088;font-weight:bold">final</span> SimpleComponentRule.Outputs outputs = COMPONENT_FACTORY.collect(processor,
                        <span style="color:#080;font-weight:bold">new</span> JoinInputFactory().withInput(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">__default__</span><span style="color:#710">&quot;</span></span>, asList(<span style="color:#080;font-weight:bold">new</span> Transform.Record(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a</span><span style="color:#710">&quot;</span></span>), <span style="color:#080;font-weight:bold">new</span> Transform.Record(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bb</span><span style="color:#710">&quot;</span></span>)))
                                              .withInput(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">second</span><span style="color:#710">&quot;</span></span>, asList(<span style="color:#080;font-weight:bold">new</span> Transform.Record(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1</span><span style="color:#710">&quot;</span></span>), <span style="color:#080;font-weight:bold">new</span> Transform.Record(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">2</span><span style="color:#710">&quot;</span></span>)))
                );
        assertEquals(<span style="color:#00D">2</span>, outputs.size());
        assertEquals(asList(<span style="color:#00D">2</span>, <span style="color:#00D">3</span>), outputs.get(<span style="color:#0a8;font-weight:bold">Integer</span>.class, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">size</span><span style="color:#710">&quot;</span></span>));
        assertEquals(asList(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a1</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bb2</span><span style="color:#710">&quot;</span></span>), outputs.get(<span style="color:#0a8;font-weight:bold">String</span>.class, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">value</span><span style="color:#710">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here again the rule allows you to instantiate a <code>Processor</code> from your code
and then to <code>collect</code> the output from the inputs you pass in. There are two convenient implementation
of the input factory:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>MainInputFactory</code> for processors using only the default input.</p>
</li>
<li>
<p><code>JoinInputfactory</code> for processors using multiple inputs have a method <code>withInput(branch, data)</code> The first arg is the branch name
and the second arg is the data used by the branch.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
you can also implement your own input representation if needed implementing <code>org.talend.sdk.component.junit.ControllableInputFactory</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_component_runtime_testing_spark">2.2. component-runtime-testing-spark</h3>
<div class="paragraph">
<p>The folowing artifact will allow you to test against a spark cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>component-runtime-testing-spark<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${talend-component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;scope&gt;</span>test<span style="color:#070;font-weight:bold">&lt;/scope&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_junit_4_3">2.2.1. JUnit 4</h4>
<div class="paragraph">
<p>The usage relies on a JUnit <code>TestRule</code>. It is recommanded to use it as a <code>@ClassRule</code> to ensure
a single instance of a spark cluster is built but you can also use it as a simple <code>@Rule</code> which means
it will be created per method instead of per test class.</p>
</div>
<div class="paragraph">
<p>It takes as parameter the spark and scala version to use. It will then fork a master and N slaves.
Finally it will give you <code>submit*</code> method allowing you to send jobs either from the test classpath
or from a shade if you run it as an integration test.</p>
</div>
<div class="paragraph">
<p>Here is a sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SparkClusterRuleTest</span> {

    <span style="color:#007">@ClassRule</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> SparkClusterRule SPARK = <span style="color:#080;font-weight:bold">new</span> SparkClusterRule(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">2.10</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1.6.3</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>);

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> classpathSubmit() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">IOException</span> {
        SPARK.submitClasspath(SubmittableMain.class, getMainArgs());

        <span style="color:#777">// do wait the test passed</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
this is working with <code>@Parameterized</code> so you can submit a bunch of jobs with different args and even combine it with beam <code>TestPipeline</code> if you make it <code>transient</code>!
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_junit_5_3">2.2.2. JUnit 5</h4>
<div class="paragraph">
<p>The integration with JUnit 5 of that spark cluster logic uses <code>@WithSpark</code> marker for the extension
and let you, optionally, inject through <code>@SparkInject</code>, the <code>BaseSpark&lt;?&gt;</code> handler to access te spark cluster
meta information - like its host/port.</p>
</div>
<div class="paragraph">
<p>Here is a basic test using it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@WithSpark</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SparkExtensionTest</span> {

    <span style="color:#007">@SparkInject</span>
    <span style="color:#088;font-weight:bold">private</span> BaseSpark&lt;?&gt; spark;

    <span style="color:#007">@Test</span>
    <span style="color:#339;font-weight:bold">void</span> classpathSubmit() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">IOException</span> {
        <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">File</span> out = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(jarLocation(SparkClusterRuleTest.class).getParentFile(), <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">classpathSubmitJunit5.out</span><span style="color:#710">&quot;</span></span>);
        <span style="color:#080;font-weight:bold">if</span> (out.exists()) {
            out.delete();
        }
        spark.submitClasspath(SparkClusterRuleTest.SubmittableMain.class, spark.getSparkMaster(), out.getAbsolutePath());

        await().atMost(<span style="color:#00D">5</span>, MINUTES).until(
                () -&gt; out.exists() ? Files.readAllLines(out.toPath()).stream().collect(joining(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#b0b">\n</span><span style="color:#710">&quot;</span></span>)).trim() : <span style="color:#069">null</span>,
                equalTo(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">b -&gt; 1</span><span style="color:#b0b">\n</span><span style="color:#D20">a -&gt; 1</span><span style="color:#710">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_to_know_the_job_is_done">2.2.3. How to know the job is done</h4>
<div class="paragraph">
<p>In current state, <code>SparkClusterRule</code> doesn&#8217;t allow to know a job execution is done - even if it exposes the webui url so
you can poll it to check. The best at the moment is to ensure the output of your job exists and contains the right value.</p>
</div>
<div class="paragraph">
<p><code>awaitability</code> or equivalent library can help you to write such logic.</p>
</div>
<div class="paragraph">
<p>Here are the coordinates of the artifact:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.awaitility<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>awaitility<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>3.0.0<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;scope&gt;</span>test<span style="color:#070;font-weight:bold">&lt;/scope&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is how to wait a file exists and its content (for instance) is the expected one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">await()
    .atMost(<span style="color:#00D">5</span>, MINUTES)
    .until(
        () -&gt; out.exists() ? Files.readAllLines(out.toPath()).stream().collect(joining(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#b0b">\n</span><span style="color:#710">&quot;</span></span>)).trim() : <span style="color:#069">null</span>,
        equalTo(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">the expected content of the file</span><span style="color:#710">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_component_runtime_http_junit">2.3. component-runtime-http-junit</h3>
<div class="paragraph">
<p>The HTTP JUnit module allows you to mock REST API very easily. Here are its coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>component-runtime-junit<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${talend-component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;scope&gt;</span>test<span style="color:#070;font-weight:bold">&lt;/scope&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
this module uses Apache Johnzon and Netty, if you have any conflict (in particular with netty) you can add the classifier <code>shaded</code>
to the dependency and the two dependencies are shaded avoiding the conflicts with your component.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It supports JUnit 4 and JUnit 5 as well but the overall concept is the exact same one: the extension/rule
is able to serve precomputed responses saved in the classpath.</p>
</div>
<div class="paragraph">
<p>You can plug your own <code>ResponseLocator</code> to map a request to a response but the default implementation - which should be sufficient
in most cases - will look in <code>talend/testing/http/&lt;class name&gt;_&lt;method name&gt;.json</code>. Note that you can also put it
in <code>talend/testing/http/&lt;request path&gt;.json</code>.</p>
</div>
<div class="sect3">
<h4 id="_junit_4_4">2.3.1. JUnit 4</h4>
<div class="paragraph">
<p>JUnit 4 setup is done through two rules: <code>JUnit4HttpApi</code> which is responsible to start the server and <code>JUnit4HttpApiPerMethodConfigurator</code>
which is responsible to configure the server per test and also handle the capture mode (see later).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
if you don&#8217;t use the <code>JUnit4HttpApiPerMethodConfigurator</code>, the capture feature will be deactivated and the per test mocking will not be available.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Most of the test will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyRESTApiTest</span> {
    <span style="color:#007">@ClassRule</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> JUnit4HttpApi API = <span style="color:#080;font-weight:bold">new</span> JUnit4HttpApi();

    <span style="color:#007">@Rule</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">final</span> JUnit4HttpApiPerMethodConfigurator configurator = <span style="color:#080;font-weight:bold">new</span> JUnit4HttpApiPerMethodConfigurator(API);

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> direct() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">Exception</span> {
        <span style="color:#777">// ... do your requests</span>
    }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_ssl">SSL</h5>
<div class="paragraph">
<p>For tests using SSL based services, you will need to use <code>activeSsl()</code> on the <code>JUnit4HttpApi</code> rule.</p>
</div>
<div class="paragraph">
<p>If you need to access the server ssl socket factory you can do it from the <code>HttpApiHandler</code> (the rule):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ClassRule</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> JUnit4HttpApi API = <span style="color:#080;font-weight:bold">new</span> JUnit4HttpApi()<strong>.activeSsl()</strong>;

<span style="color:#007">@Test</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> test() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">Exception</span> {
    <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">HttpsURLConnection</span> connection = getHttpsConnection();
    connection.setSSLSocketFactory(API.getSslContext().getSocketFactory());
    <span style="color:#777">// ....</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_junit_5_4">2.3.2. JUnit 5</h4>
<div class="paragraph">
<p>JUnit 5 uses a JUnit 5 extension based on the <code>HttpApi</code> annotation you can put on your test class. You can inject
the test handler (which has some utilities for advanced cases) through <code>@HttpApiInject</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@HttpApi</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">JUnit5HttpApiTest</span> {
    <span style="color:#007">@HttpApiInject</span>
    <span style="color:#088;font-weight:bold">private</span> HttpApiHandler&lt;?&gt; handler;

    <span style="color:#007">@Test</span>
    <span style="color:#339;font-weight:bold">void</span> getProxy() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">Exception</span> {
        <span style="color:#777">// .... do your requests</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the injection is optional and the <code>@HttpApi</code> allows you to configure several behaviors of the test.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_ssl_2">SSL</h5>
<div class="paragraph">
<p>For tests using SSL based services, you will need to use <code>@HttpApi(useSsl = true)</code>.</p>
</div>
<div class="paragraph">
<p>You can access the client SSL socket factory through the api handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@HttpApi</span><strong>(useSsl = <span style="color:#069">true</span>)</strong>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyHttpsApiTest</span> {
    <span style="color:#007">@HttpApiInject</span>
    <span style="color:#088;font-weight:bold">private</span> HttpApiHandler&lt;?&gt; handler;

    <span style="color:#007">@Test</span>
    <span style="color:#339;font-weight:bold">void</span> test() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">Exception</span> {
        <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">HttpsURLConnection</span> connection = getHttpsConnection();
        connection.setSSLSocketFactory(handler.getSslContext().getSocketFactory());
        <span style="color:#777">// ....</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_capturing_mode">2.3.3. Capturing mode</h4>
<div class="paragraph">
<p>The strength of this implementation is to run a small proxy server and auto configure the JVM:
<code>http[s].proxyHost</code>, <code>http[s].proxyPort</code>, <code>HttpsURLConnection#defaultSSLSocketFactory</code> and <code>SSLContext#default</code>
are auto configured to work out of the box with the proxy.</p>
</div>
<div class="paragraph">
<p>It allows you to keep in your tests the native and real URLs. For instance this test is perfectlt valid:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">GoogleTest</span> {
    <span style="color:#007">@ClassRule</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> JUnit4HttpApi API = <span style="color:#080;font-weight:bold">new</span> JUnit4HttpApi();

    <span style="color:#007">@Rule</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">final</span> JUnit4HttpApiPerMethodConfigurator configurator = <span style="color:#080;font-weight:bold">new</span> JUnit4HttpApiPerMethodConfigurator(API);

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> google() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">Exception</span> {
        assertEquals(<span style="color:#0a8;font-weight:bold">HttpURLConnection</span>.HTTP_OK, get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">https://google.fr?q=Talend</span><span style="color:#710">&quot;</span></span>));
    }

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">int</span> get(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span> uri) <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">Exception</span> {
        <span style="color:#777">// do the GET request, skipped for brievity</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you execute this test, it will fail with a HTTP 400 because the proxy doesn&#8217;t find the mocked response.
You can create it manually as seen in the introduction of the module but you can also set the property <code>talend.junit.http.capture</code>
to the folder where to store the captures. It must be the root folder and not the folder where the json are (ie not prefixed by <code>talend/testing/http</code> by default).</p>
</div>
<div class="paragraph">
<p>Generally you will want to use <code>src/test/resources</code>. If <code>new File("src/test/resources")</code> resolves to the valid folder when executing your test (Maven default),
then you can just set the system property to true, otherwise you need to adjust accordingly the system property value.</p>
</div>
<div class="paragraph">
<p>Once you ran the tests with this system property, the testing framework will have created the correct mock response files and you can
remove the system property. The test will still pass, using <code>google.com</code>&#8230;&#8203;even if you disconnect your machine from the internet.</p>
</div>
<div class="paragraph">
<p>The rule (extension) is doing all the work for you :).</p>
</div>
</div>
<div class="sect3">
<h4 id="_passthrough_mode">2.3.4. Passthrough mode</h4>
<div class="paragraph">
<p>Setting <code>talend.junit.http.passthrough</code> system property to <code>true</code>, the server will just be a proxy and will execute each request
to the actual server - like in capturing mode.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_beam_testing">3. Beam testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to ensure your component works in Beam the minimum to do is to try with the direct runner (if you don&#8217;t want to use spark).</p>
</div>
<div class="paragraph">
<p>Check <a href="https://beam.apache.org/contribute/testing/" class="bare">beam.apache.org/contribute/testing/</a> out for more details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multiple_environments_for_the_same_tests">4. Multiple environments for the same tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>JUnit (4 or 5) already provides some ways to parameterized tests and execute the same "test logic"
against several data. However it is not that convenient to test multiple environments.</p>
</div>
<div class="paragraph">
<p>For instance, with Beam, you can desire to test against multiple runners your code
and it requires to solve conflicts between runner dependencies, setup the correct classloaders
etc&#8230;&#8203;It is a lot of work!</p>
</div>
<div class="paragraph">
<p>To simplify such cases, the framework provides you a multi-environment support for your tests.</p>
</div>
<div class="paragraph">
<p>It is in the junit module and is usable with JUnit 4 and JUnit 5.</p>
</div>
<div class="sect2">
<h3 id="_junit_4_5">4.1. JUnit 4</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@RunWith</span>(MultiEnvironmentsRunner.class)
<span style="color:#007">@Environment</span>(Env1.class)
<span style="color:#007">@Environment</span>(Env1.class)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TheTest</span> {
    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> test1() {
        <span style="color:#777">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>MultiEnvironmentsRunner</code> will execute the test(s) for each defined environments. It means it will
run <code>test1</code> for <code>Env1</code> and <code>Env2</code> in previous example.</p>
</div>
<div class="paragraph">
<p>By default <code>JUnit4</code> runner will be used to execute the tests in one environment but you can use <code>@DelegateRunWith</code>
to use another runner.</p>
</div>
</div>
<div class="sect2">
<h3 id="_junit_5_5">4.2. JUnit 5</h3>
<div class="paragraph">
<p>JUnit 5 configuration is close to JUnit 4 one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Environment</span>(EnvironmentsExtensionTest.E1.class)
<span style="color:#007">@Environment</span>(EnvironmentsExtensionTest.E2.class)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TheTest</span> {

    <span style="color:#007">@EnvironmentalTest</span>
    <span style="color:#339;font-weight:bold">void</span> test1() {
        <span style="color:#777">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The main difference is you don&#8217;t use a runner (it doesn&#8217;t exist in JUnit 5) and you replace <code>@Test</code> by <code>@EnvironmentalTest</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
the main difference with JUnit 4 integration is that the tests are execute one after each other for all environments
instead of running all tests in each environments sequentially. It means, for instance, that <code>@BeforeAll</code> and <code>@AfterAll</code> are executed
once for all runners.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_provided_environments">4.3. Provided environments</h3>
<div class="paragraph">
<p>The provided environment setup the contextual classloader to load the related runner of Apache Beam.</p>
</div>
<div class="paragraph">
<p>Package: <code>org.talend.sdk.component.junit.environment.builtin.beam</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the configuration is read from system properties, environment variables, &#8230;&#8203;.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all table-striped table-hover table-ordered">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DirectRunnerEnvironment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct runner</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FlinkRunnerEnvironment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flink</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flink runner</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SparkRunnerEnvironment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spark</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spark runner</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_configuring_environments">4.4. Configuring environments</h3>
<div class="paragraph">
<p>If the environment extends <code>BaseEnvironmentProvider</code> and therefore defines an environment name - which is the case of the default ones, you can use <code>EnvironmentConfiguration</code>
to customize the system properties used for that environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Environment</span>(DirectRunnerEnvironment.class)
<span style="color:#007">@EnvironmentConfiguration</span>(
    environment = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Direct</span><span style="color:#710">&quot;</span></span>,
    systemProperties = <span style="color:#007">@EnvironmentConfiguration</span>.Property(key = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">beamTestPipelineOptions</span><span style="color:#710">&quot;</span></span>, value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">...</span><span style="color:#710">&quot;</span></span>))

<span style="color:#007">@Environment</span>(SparkRunnerEnvironment.class)
<span style="color:#007">@EnvironmentConfiguration</span>(
    environment = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Spark</span><span style="color:#710">&quot;</span></span>,
    systemProperties = <span style="color:#007">@EnvironmentConfiguration</span>.Property(key = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">beamTestPipelineOptions</span><span style="color:#710">&quot;</span></span>, value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">...</span><span style="color:#710">&quot;</span></span>))

<span style="color:#007">@Environment</span>(FlinkRunnerEnvironment.class)
<span style="color:#007">@EnvironmentConfiguration</span>(
    environment = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Flink</span><span style="color:#710">&quot;</span></span>,
    systemProperties = <span style="color:#007">@EnvironmentConfiguration</span>.Property(key = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">beamTestPipelineOptions</span><span style="color:#710">&quot;</span></span>, value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">...</span><span style="color:#710">&quot;</span></span>))
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyBeamTest</span> {

    <span style="color:#007">@EnvironmentalTest</span>
    <span style="color:#339;font-weight:bold">void</span> execute() {
        <span style="color:#777">// run some pipeline</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
if you set the system property <code>&lt;environment name&gt;.skip=true</code> then the environment related executions will be skipped.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_secrets_passwords_and_maven">5. Secrets/Passwords and Maven</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you desire you can reuse your Maven <code>settings.xml</code> servers - including the encrypted ones.
<code>org.talend.sdk.component.maven.MavenDecrypter</code> will give you the ability to find a server <code>username</code>/<code>password</code> from
a server identifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">final</span> MavenDecrypter decrypter = <span style="color:#080;font-weight:bold">new</span> MavenDecrypter();
<span style="color:#088;font-weight:bold">final</span> Server decrypted = decrypter.find(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my-test-server</span><span style="color:#710">&quot;</span></span>);
<span style="color:#777">// decrypted.getUsername();</span>
<span style="color:#777">// decrypted.getPassword();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is very useful to not store secrets and test on real systems on a continuous integration platform.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
even if you don&#8217;t use maven on the platform you can generate the <code>settings.xml</code> and <code>settings-security.xml</code> files
to use that feature. See <a href="https://maven.apache.org/guides/mini/guide-encryption.html" class="bare">maven.apache.org/guides/mini/guide-encryption.html</a> for more details.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generating_data">6. Generating data?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Several data generator exists if you want to populate objects with a semantic a bit more evolved than a plain random string
like <code>commons-lang3</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/Codearte/jfairy" class="bare">github.com/Codearte/jfairy</a></p>
</li>
<li>
<p><a href="https://github.com/DiUS/java-faker" class="bare">github.com/DiUS/java-faker</a></p>
</li>
<li>
<p><a href="https://github.com/andygibson/datafactory" class="bare">github.com/andygibson/datafactory</a></p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A bit more advanced, these ones allow to bind directly generic data on a model - but data quality is not always there:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devopsfolks/podam" class="bare">github.com/devopsfolks/podam</a></p>
</li>
<li>
<p><a href="https://github.com/benas/random-beans" class="bare">github.com/benas/random-beans</a></p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note there are two main kind of implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the one using a <em>pattern</em> and random generated data</p>
</li>
<li>
<p>a set of precomputed data extrapolated to create new values</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Check against your use case to know which one is the best.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
an interesting alternative to data generation is to import <em>real</em> data and use Talend Studio to sanitize the data (remove sensitive information replacing them by generated data or anonymized data)
and just inject that file into the system.
</td>
</tr>
</table>
</div>
</div>
</div>
            </div>
            
        </div>
    </div>


    <footer>
        <div class="row">
          <div class="col-lg-12">

            <ul class="list-unstyled">
              <li class="pull-right"><a href="#top">Back to top</a></li>
            </ul>
          </div>
        </div>
    </footer>
    </div>

    <script src="js/jquery-1.10.2.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap.js"></script>
  </body>
</html>

