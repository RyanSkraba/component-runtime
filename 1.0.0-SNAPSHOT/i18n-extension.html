
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Talend Component Documentation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="stylesheet" href="css/bootstrap.css" media="screen">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ink/3.1.0/css/font-awesome.min.css" integrity="sha256-MUe1D3T3ocGLZQ2h8wgpcIz5BoTu1OZo8q0BjK5u/o0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.min.css" />
    <!--[if lt IE 9]>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.ie.min.css" />
    <![endif]-->
    <link rel="stylesheet" href="css/documentation.css">
    <link rel="shortcut icon" href="images/favicon_0.ico" />
    <style>
    body{padding-top:50px}body>.navbar{-webkit-transition:background-color .3s ease-in;transition:background-color .3s ease-in}@media (min-width:768px){body>.navbar-transparent{background-color:transparent}body>.navbar-transparent .navbar-nav>.open>a{background-color:transparent!important}}#home{padding-top:0}#home .navbar-brand{padding:13.5px 15px 12.5px}#home .navbar-brand>img{display:inline;margin:0 10px;height:100%}#banner{min-height:300px;border-bottom:none}.table-of-contents{margin-top:1em}.page-header h1{font-size:4em}.bs-docs-section{margin-top:6em}.bs-docs-section h1{padding-top:100px}.bs-component{position:relative}.bs-component .modal{position:relative;top:auto;right:auto;left:auto;bottom:auto;z-index:1;display:block}.bs-component .modal-dialog{width:90%}.bs-component .popover{position:relative;display:inline-block;width:220px;margin:20px}#source-button{position:absolute;top:0;right:0;z-index:100;font-weight:700}.progress{margin-bottom:10px}footer{margin:5em 0}footer li{float:left;margin-right:1.5em;margin-bottom:1.5em}footer p{clear:left;margin-bottom:0}.splash{padding:9em 0 2em;background-color:#141d27;background-image:url(../img/bg.jpg);background-size:cover;background-attachment:fixed;color:#fff;text-align:center}.splash .logo{width:160px}.splash h1{font-size:3em}.splash #social{margin:2em 0}.splash .alert{margin:2em 0}.section-tout{padding:4em 0 3em;border-bottom:1px solid rgba(0,0,0,.05);background-color:#eaf1f1}.section-tout .fa{margin-right:.5em}.section-tout p{margin-bottom:3em}.section-preview{padding:4em 0 4em}.section-preview .preview{margin-bottom:4em;background-color:#eaf1f1}.section-preview .preview .image{position:relative}.section-preview .preview .image:before{box-shadow:inset 0 0 0 1px rgba(0,0,0,.1);position:absolute;top:0;left:0;width:100%;height:100%;content:"";pointer-events:none}.section-preview .preview .options{padding:1em 2em 2em;border:1px solid rgba(0,0,0,.05);border-top:none;text-align:center}.section-preview .preview .options p{margin-bottom:2em}.section-preview .dropdown-menu{text-align:left}.section-preview .lead{margin-bottom:2em}@media (max-width:767px){.section-preview .image img{width:100%}}.sponsor #carbonads{max-width:240px;margin:0 auto}.sponsor .carbon-text{display:block;margin-top:1em;font-size:12px}.sponsor .carbon-poweredby{float:right;margin-top:1em;font-size:10px}@media (max-width:767px){.splash{padding-top:4em}.splash .logo{width:100px}.splash h1{font-size:2em}#banner{margin-bottom:2em;text-align:center}}
    </style>
  </head>
  <body>
    <a class="github-fork-ribbon" target="_blank"
        href="https://github.com/talend/component-runtime" data-ribbon="Fork me on GitHub"
        title="Fork me on GitHub">Fork me on GitHub</a>
    <div class="col-sm-offset-1 col-sm-10">

	
<div class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <a href="/component-runtime/index.html" class="navbar-brand">Component Kit</a>
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div class="navbar-collapse collapse" id="navbar-main">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="entries">Documentation <span class="caret"></span></a>
          <ul class="dropdown-menu" aria-labelledby="entries">
            <li><a href="/component-runtime/index.html">Home</a></li>
            <li><a href="documentation-overview.html">Overview</a></li>
            <li><a href="getting-started.html">Getting Started</a></li>
            <li><a href="documentation.html">Reference</a></li>
            <li><a href="best-practices.html">Best Practices</a></li>
            <li><a href="documentation-testing.html">Testing</a></li>
            <li><a href="documentation-rest.html">REST API</a></li>
            <li><a href="wrapping-a-beam-io.html">How to wrap a Beam I/O</a></li>
            <li><a href="studio.html">Studio Integration</a></li>
            <li><a href="changelog.html">Changelog</a></li>
            <li><a href="contributors.html">Wall of Fame</a></li>
            <li><a href="apidocs.html">API Documentation</a></li>
            <li><a href="appendix.html">Appendix</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="versions">Versions <span class="caret"></span></a>
          <ul class="dropdown-menu" aria-labelledby="versions">
            <li><a href="/component-runtime/index.html">Current</a></li>
            <li><a href="/component-runtime/latest/index.html">Latest</a></li>
            
          </ul>
        </li>
      </ul>
    </div>
  </div>
</div>


    <div class="container section-padded">
        <div class="row title">
            <div class='page-header'>
              <h2>Talend Component i18n Extension</h2>
            </div>
        </div>
        <div class="row">
            
            <div class="col-md-12">
                <div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_goal">1. Goal</a></li>
<li><a href="#_installation">2. Installation</a>
<ul class="sectlevel2">
<li><a href="#_java_8">2.1. Java 8</a></li>
</ul>
</li>
<li><a href="#_usage">3. Usage</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_goal">1. Goal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The high level goal is to allow you to plug any resource bundle implementation on the JVM
and therefore plug the logic you want behind lines like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#0a8;font-weight:bold">ResourceBundle</span> rb = <span style="color:#0a8;font-weight:bold">ResourceBundle</span>.getBundle(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my.Bundle</span><span style="color:#710">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ResourceBundle</code> is the standard API in Java for internationalization and is used by the component framework.
By default it supports two formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>properties where files are suffixed with <code>[_&lt;locale&gt;].properties</code></p>
</li>
<li>
<p>classes where the classes are loaded from the bundle name with the same kind of naming convention than the properties flavor</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However both solutions imply to put the translations aside the code and to bundle it along side the sources.
In practise it is common to externalize the translations to let people interact with it more easily or even plug their own messages.</p>
</div>
<div class="paragraph">
<p>To solve that, the <code>i18n-loader</code> module plugs a global strategy which is tested before any default strategy.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">2. Installation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_java_8">2.1. Java 8</h3>
<div class="paragraph">
<p>On Java 8 you need to download the <code>i18n-loader.jar</code> and add it to your extension classloader. It is done
setting the system property <code>java.ext.dirs</code> on the JVM. Here are the detailled steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>download <code>i18n-loader.jar</code> in a folder (we will use <code>/opt/exts/</code> in our examples)</p>
</li>
<li>
<p>set on your JVM the <code>java.ext.dirs</code> system property based on the default one (<code>$JRE_HOME/lib/ext</code>) and our custom <code>/opt/exts</code> directory:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>// for linux when JAVA_HOME is a JRE
"-Djava.ext.dirs=$JAVA_HOME/lib/ext:/opt/exts"

// for linux when JAVA_HOME is a JDK
"-Djava.ext.dirs=$JAVA_HOME/jre/lib/ext:/opt/exts"

// for windows when JAVA_HOME is a JRE
-Djava.ext.dirs=%JAVA_HOME%/lib/ext;/opt/exts

// for windows when JAVA_HOME is a JDK
-Djava.ext.dirs=%JAVA_HOME%/jre/lib/ext;/opt/exts</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage">3. Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The extension itself doesn&#8217;t provide any alternative implementation and just setting it up you will fallback
on the default JVM behavior.</p>
</div>
<div class="paragraph">
<p>However it provides API to register custom logic.</p>
</div>
<div class="paragraph">
<p>The entry point is the <code>ProviderLocator</code> which allows you to register a custom <code>ResourceBundleControlProvider</code>
and associate it with a <code>ClassLoader</code> used as identifier for an application. This means you can register
one provider per application if desired!</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
you don&#8217;t need to register your <code>ResourceBundleControlProvider</code> through Java SPI mecanism (<code>META-INF/services</code>),
the extension only uses the <code>ProviderLocator</code> registry.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then you need to register your own implementation using the register method of the locator. It will return you
a <code>Runnable</code> you have to call when you undeploy/shutdown your application to unregister your implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Runnable</span> deregister = ProviderLocator.instance().register(myAppClassLoader, <span style="color:#080;font-weight:bold">new</span> MyCustomControlProvider());
<span style="color:#777">// app life</span>
deregister.run();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a servlet context you can use a web listener:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@WebListener</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyI18nLifecycle</span> implement ServletContextListener {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Runnable</span> deregister;

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> contextInitialized(ServletContextEvent evt) {
        deregister = ProviderLocator.instance()
            .register(evt.getServletContext().getClassLoader(), <span style="color:#080;font-weight:bold">new</span> MyCustomControlProvider());
    }

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> contextDestroyed(ServletContextEvent evt) {
        deregister.run();
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
if you use maven don&#8217;t forget to use the scope <code>provided</code> for <code>i18n-loader</code> dependency.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To implement your custom control provider the library provides you some helper classes.</p>
</div>
<div class="paragraph">
<p>The main helpers are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BaseProvider</code> which simplifies the control provider implementation, it provides a filter of supported bundles
and the bundle factory:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyControlProvider</span> <span style="color:#088;font-weight:bold">extends</span> BaseProvider {
    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">protected</span> <span style="color:#339;font-weight:bold">boolean</span> supports(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span> baseName) {
        <span style="color:#080;font-weight:bold">return</span> baseName.startsWith(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">com.company.</span><span style="color:#710">&quot;</span></span>);
    }

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">protected</span> <span style="color:#0a8;font-weight:bold">ResourceBundle</span> createBundle(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span> baseName, <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Locale</span> locale) {
        <span style="color:#080;font-weight:bold">return</span> ...;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this base has also a shortcut in the provider locator for the registration allowing you
to use lambdas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#777">// newBundle is your custom bundle creation logic</span>
ProviderLocator.instance()
  .register(loader, name -&gt; name.startsWith(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">com.company</span><span style="color:#710">&quot;</span></span>), (name, locale) -&gt; newBundle(name, locale));</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BaseControl</code> is an adapter of <code>java.util.ResourceBundle.Control</code></p>
</li>
<li>
<p><code>BaseBundle</code> is an adapter of <code>java.util.ResourceBundle</code> allowing you to implement only a few methods:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyBundle</span> <span style="color:#088;font-weight:bold">extends</span> BaseBundle {
    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">protected</span> <span style="color:#0a8;font-weight:bold">Set</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; doGetKeys() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#0a8;font-weight:bold">Collections</span>.singleton(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">thekey</span><span style="color:#710">&quot;</span></span>);
    }

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">protected</span> <span style="color:#0a8;font-weight:bold">Object</span> handleGetObject(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span> key) {
        <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">thekey</span><span style="color:#710">&quot;</span></span>.equals(key) ? <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">thevalue</span><span style="color:#710">&quot;</span></span> : <span style="color:#069">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In practise you will pass it the bundle name and locale from a <code>BaseProvider</code> or equivalent
and load the keys with some custom logic.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MapBundle</code> is a custom resource bundle backed by a map, in practise you will likely pass a concurrent map
implementation to support live updates if needed from the outside of the bundle</p>
</li>
</ul>
</div>
</div>
</div>
            </div>
            
        </div>
    </div>


    <footer>
        <div class="row">
          <div class="col-lg-12">

            <ul class="list-unstyled">
              <li class="pull-right"><a href="#top">Back to top</a></li>
            </ul>
          </div>
        </div>
    </footer>
    </div>

    <script src="js/jquery-1.10.2.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap.js"></script>
  </body>
</html>

