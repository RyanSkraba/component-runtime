
<!DOCTYPE html>

<html lang="en">
  <head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PSBN"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config', 'GTM-PSBN');
    </script>
    <script async type="text/javascript" src="https://cse.google.com/cse.js?cx=005944347463368867332:ghrpamlmyqy"></script>

    <meta charset="utf-8">
    <title>Talend Component Documentation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="date" content="2018-02-08 17:27:11" scheme="YYYY-MM-dd HH:mm:ss">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="stylesheet" href="css/bootstrap.css" media="screen">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ink/3.1.0/css/font-awesome.min.css" integrity="sha256-MUe1D3T3ocGLZQ2h8wgpcIz5BoTu1OZo8q0BjK5u/o0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.min.css" />
    <!--[if lt IE 9]>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.ie.min.css" />
    <![endif]-->
    <link rel="stylesheet" href="css/documentation.css">
    <link rel="shortcut icon" href="images/favicon_0.ico" />
    <style>
    body{padding-top:50px}body>.navbar{-webkit-transition:background-color .3s ease-in;transition:background-color .3s ease-in}@media (min-width:768px){body>.navbar-transparent{background-color:transparent}body>.navbar-transparent .navbar-nav>.open>a{background-color:transparent!important}}#home{padding-top:0}#home .navbar-brand{padding:13.5px 15px 12.5px}#home .navbar-brand>img{display:inline;margin:0 10px;height:100%}#banner{min-height:300px;border-bottom:none}.table-of-contents{margin-top:1em}.page-header h1{font-size:4em}.bs-docs-section{margin-top:6em}.bs-docs-section h1{padding-top:100px}.bs-component{position:relative}.bs-component .modal{position:relative;top:auto;right:auto;left:auto;bottom:auto;z-index:1;display:block}.bs-component .modal-dialog{width:90%}.bs-component .popover{position:relative;display:inline-block;width:220px;margin:20px}#source-button{position:absolute;top:0;right:0;z-index:100;font-weight:700}.progress{margin-bottom:10px}footer{margin:5em 0}footer li{float:left;margin-right:1.5em;margin-bottom:1.5em}footer p{clear:left;margin-bottom:0}.splash{padding:9em 0 2em;background-color:#141d27;background-image:url(../img/bg.jpg);background-size:cover;background-attachment:fixed;color:#fff;text-align:center}.splash .logo{width:160px}.splash h1{font-size:3em}.splash #social{margin:2em 0}.splash .alert{margin:2em 0}.section-tout{padding:4em 0 3em;border-bottom:1px solid rgba(0,0,0,.05);background-color:#eaf1f1}.section-tout .fa{margin-right:.5em}.section-tout p{margin-bottom:3em}.section-preview{padding:4em 0 4em}.section-preview .preview{margin-bottom:4em;background-color:#eaf1f1}.section-preview .preview .image{position:relative}.section-preview .preview .image:before{box-shadow:inset 0 0 0 1px rgba(0,0,0,.1);position:absolute;top:0;left:0;width:100%;height:100%;content:"";pointer-events:none}.section-preview .preview .options{padding:1em 2em 2em;border:1px solid rgba(0,0,0,.05);border-top:none;text-align:center}.section-preview .preview .options p{margin-bottom:2em}.section-preview .dropdown-menu{text-align:left}.section-preview .lead{margin-bottom:2em}@media (max-width:767px){.section-preview .image img{width:100%}}.sponsor #carbonads{max-width:240px;margin:0 auto}.sponsor .carbon-text{display:block;margin-top:1em;font-size:12px}.sponsor .carbon-poweredby{float:right;margin-top:1em;font-size:10px}@media (max-width:767px){.splash{padding-top:4em}.splash .logo{width:100px}.splash h1{font-size:2em}#banner{margin-bottom:2em;text-align:center}}
    </style>
  </head>
  <body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PSBN"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <a class="github-fork-ribbon" target="_blank"
        href="https://github.com/talend/component-runtime" data-ribbon="Fork me on GitHub"
        title="Fork me on GitHub">Fork me on GitHub</a>
    <div class="col-sm-offset-1 col-sm-10">

	
<div class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <a href="/component-runtime/index.html" class="navbar-brand">Component Kit</a>
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div class="navbar-collapse collapse" id="navbar-main">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="entries">Documentation <span class="caret"></span></a>
          <ul class="dropdown-menu" aria-labelledby="entries">
            <li><a href="/component-runtime/index.html">Home</a></li>
            <li><a href="documentation-overview.html">Overview</a></li>
            <li><a href="getting-started.html">Getting Started</a></li>
            <li><a href="documentation.html">Reference</a></li>
            <li><a href="best-practices.html">Best Practices</a></li>
            <li><a href="documentation-testing.html">Testing</a></li>
            <li><a href="documentation-rest.html">REST API</a></li>
            <li><a href="wrapping-a-beam-io.html">How to wrap a Beam I/O</a></li>
            <li><a href="studio.html">Studio Integration</a></li>
            <li><a href="changelog.html">Changelog</a></li>
            <li><a href="contributors.html">Wall of Fame</a></li>
            <li><a href="apidocs.html">API Documentation</a></li>
            <li><a href="appendix.html">Appendix</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="versions">Versions <span class="caret"></span></a>
          <ul class="dropdown-menu" aria-labelledby="versions">
            <li><a href="/component-runtime/index.html">Current</a></li>
            <li><a href="/component-runtime/latest/index.html">Latest</a></li>
            
          </ul>
        </li>
      </ul>
      <div class="navbar-collapse collapse">
        <form class="navbar-form navbar-right" role="search" action="search.html">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search" name="q">
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


    <div class="container section-padded">
        <div class="row title">
            <div class='page-header'>
              <h2>Talend Component Documentation</h2>
            </div>
        </div>
        <div class="row">
            
            <div class="col-md-12">
                <div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_talend_components_definitions_documentation">Talend Components Definitions Documentation</a>
<ul class="sectlevel1">
<li><a href="#_components_definitions">1. Components Definitions</a>
<ul class="sectlevel2">
<li><a href="#_partitionmapper">1.1. PartitionMapper</a>
<ul class="sectlevel3">
<li><a href="#_definition">1.1.1. Definition</a>
<ul class="sectlevel4">
<li><a href="#_assessor">@Assessor</a></li>
<li><a href="#_split">@Split</a></li>
<li><a href="#_emitter">@Emitter</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_producer">1.2. Producer</a></li>
<li><a href="#_processor">1.3. Processor</a></li>
<li><a href="#_multiple_outputs">1.4. Multiple outputs</a></li>
<li><a href="#_multiple_inputs">1.5. Multiple inputs</a>
<ul class="sectlevel3">
<li><a href="#_output">1.5.1. Output</a></li>
</ul>
</li>
<li><a href="#_combiners">1.6. Combiners?</a></li>
</ul>
</li>
<li><a href="#_configuring_component">2. Configuring component</a>
<ul class="sectlevel2">
<li><a href="#_primitives">2.1. Primitives</a></li>
<li><a href="#_complex_object_mapping">2.2. Complex object mapping</a>
<ul class="sectlevel3">
<li><a href="#_list_case">2.2.1. List case</a></li>
<li><a href="#_map_case">2.2.2. Map case</a></li>
</ul>
</li>
<li><a href="#_constraints_and_validation_on_the_configuration_input">2.3. Constraints and validation on the configuration/input</a></li>
<li><a href="#_marking_a_configuration_as_a_particular_type_of_data">2.4. Marking a configuration as a particular type of data</a></li>
<li><a href="#_define_links_between_properties">2.5. Define links between properties</a></li>
<li><a href="#documentation-ui-hints">2.6. Add hints about the rendering based on configuration/component knowledge</a></li>
</ul>
</li>
<li><a href="#_gallery">3. Gallery</a>
<ul class="sectlevel2">
<li><a href="#_widgets">3.1. Widgets</a></li>
<li><a href="#_validations">3.2. Validations</a></li>
</ul>
</li>
<li><a href="#_registering_components">4. Registering components</a>
<ul class="sectlevel2">
<li><a href="#_components_metadata">4.1. Components metadata</a>
<ul class="sectlevel3">
<li><a href="#_management_of_configuration_versions">4.1.1. Management of configuration versions</a></li>
<li><a href="#_partitionmapper_2">4.1.2. @PartitionMapper</a>
<ul class="sectlevel4">
<li><a href="#_emitter_2">@Emitter</a></li>
</ul>
</li>
<li><a href="#_processor_2">4.1.3. @Processor</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_internationalization">5. Internationalization</a>
<ul class="sectlevel2">
<li><a href="#_default_components_keys">5.1. Default components keys</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_components_packaging">Components Packaging</a>
<ul class="sectlevel1">
<li><a href="#_component_loading">1. Component loading</a>
<ul class="sectlevel2">
<li><a href="#_packaging_a_plugin">1.1. Packaging a plugin</a></li>
<li><a href="#_packaging_an_application">1.2. Packaging an application</a>
<ul class="sectlevel3">
<li><a href="#_dependencies">1.2.1. Dependencies</a>
<ul class="sectlevel4">
<li><a href="#_create_a_nested_maven_repository_with_maven_shade_plugin">Create a nested maven repository with maven-shade-plugin</a></li>
</ul>
</li>
<li><a href="#_listing_needed_plugins">1.2.2. Listing needed plugins</a></li>
<li><a href="#_code_maven_shade_plugin_code_extensions">1.2.3. <code>maven-shade-plugin</code> extensions</a>
<ul class="sectlevel4">
<li><a href="#_containerdependenciestransformer">ContainerDependenciesTransformer</a></li>
<li><a href="#_plugintransformer">PluginTransformer</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_build_tools">Build tools</a>
<ul class="sectlevel1">
<li><a href="#_maven_plugin">1. Maven Plugin</a>
<ul class="sectlevel2">
<li><a href="#_dependencies_2">1.1. Dependencies</a></li>
<li><a href="#_validate">1.2. Validate</a></li>
<li><a href="#_documentation">1.3. Documentation</a>
<ul class="sectlevel3">
<li><a href="#_render_your_documentation">1.3.1. Render your documentation</a>
<ul class="sectlevel4">
<li><a href="#_html">HTML</a></li>
<li><a href="#_pdf">PDF</a></li>
<li><a href="#_include_the_documentation_into_a_document">Include the documentation into a document</a></li>
<li><a href="#_more">More</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_web">1.4. Web</a></li>
<li><a href="#_generate_inputs_or_outputs">1.5. Generate inputs or outputs</a></li>
</ul>
</li>
<li><a href="#_gradle_plugin">2. Gradle Plugin</a></li>
</ul>
</li>
<li><a href="#_services">Services</a>
<ul class="sectlevel1">
<li><a href="#_internationalization_2">1. Internationalization</a>
<ul class="sectlevel2">
<li><a href="#_internationalization_api">1.1. Internationalization API</a></li>
</ul>
</li>
<li><a href="#_providing_some_actions_for_consumers_clients">2. Providing some actions for consumers/clients</a>
<ul class="sectlevel2">
<li><a href="#_particular_action_types">2.1. Particular action types</a></li>
</ul>
</li>
<li><a href="#_built_in_services">3. Built in services</a>
<ul class="sectlevel2">
<li><a href="#_httpclient_usage">3.1. HttpClient usage</a>
<ul class="sectlevel3">
<li><a href="#_advanced_http_client_request_customization">3.1.1. Advanced HTTP client request customization</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_services_and_interceptors">4. Services and interceptors</a></li>
<li><a href="#_creating_an_execution_chain_or_pipeline">5. Creating an execution chain or pipeline</a>
<ul class="sectlevel2">
<li><a href="#_standalone_chains">5.1. Standalone chains</a></li>
<li><a href="#_beam_case">5.2. Beam case</a>
<ul class="sectlevel3">
<li><a href="#_i_o">5.2.1. I/O</a></li>
<li><a href="#_processors">5.2.2. Processors</a></li>
<li><a href="#_deployment">5.2.3. Deployment</a></li>
<li><a href="#_convert_a_beam_io_in_a_component_i_o">5.2.4. Convert a Beam.io in a component I/O</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_advanced_define_a_custom_api">6. Advanced: define a custom API</a>
<ul class="sectlevel2">
<li><a href="#_extending_the_ui">6.1. Extending the UI</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_talend_component_testing_documentation">Talend Component Testing Documentation</a>
<ul class="sectlevel1">
<li><a href="#documentation-testing-start">1. Best practises</a>
<ul class="sectlevel2">
<li><a href="#_parameterized_tests">1.1. Parameterized tests</a>
<ul class="sectlevel3">
<li><a href="#_junit_4">1.1.1. JUnit 4</a></li>
<li><a href="#_junit_5">1.1.2. JUnit 5</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_component_runtime_testing">2. component-runtime-testing</a>
<ul class="sectlevel2">
<li><a href="#_component_runtime_junit">2.1. component-runtime-junit</a>
<ul class="sectlevel3">
<li><a href="#_junit_4_2">2.1.1. JUnit 4</a></li>
<li><a href="#_junit_5_2">2.1.2. JUnit 5</a></li>
<li><a href="#_mocking_the_output">2.1.3. Mocking the output</a></li>
<li><a href="#_mocking_the_input">2.1.4. Mocking the input</a></li>
<li><a href="#_creating_runtime_configuration_from_component_configuration">2.1.5. Creating runtime configuration from component configuration</a></li>
<li><a href="#_testing_a_mapper">2.1.6. Testing a Mapper</a></li>
<li><a href="#_testing_a_processor">2.1.7. Testing a Processor</a></li>
</ul>
</li>
<li><a href="#_component_runtime_testing_spark">2.2. component-runtime-testing-spark</a>
<ul class="sectlevel3">
<li><a href="#_junit_4_3">2.2.1. JUnit 4</a></li>
<li><a href="#_junit_5_3">2.2.2. JUnit 5</a></li>
<li><a href="#_how_to_know_the_job_is_done">2.2.3. How to know the job is done</a></li>
</ul>
</li>
<li><a href="#_component_runtime_http_junit">2.3. component-runtime-http-junit</a>
<ul class="sectlevel3">
<li><a href="#_junit_4_4">2.3.1. JUnit 4</a>
<ul class="sectlevel4">
<li><a href="#_ssl">SSL</a></li>
</ul>
</li>
<li><a href="#_junit_5_4">2.3.2. JUnit 5</a>
<ul class="sectlevel4">
<li><a href="#_ssl_2">SSL</a></li>
</ul>
</li>
<li><a href="#_capturing_mode">2.3.3. Capturing mode</a></li>
<li><a href="#_passthrough_mode">2.3.4. Passthrough mode</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_beam_testing">3. Beam testing</a></li>
<li><a href="#_multiple_environments_for_the_same_tests">4. Multiple environments for the same tests</a>
<ul class="sectlevel2">
<li><a href="#_junit_4_5">4.1. JUnit 4</a></li>
<li><a href="#_junit_5_5">4.2. JUnit 5</a></li>
<li><a href="#_provided_environments">4.3. Provided environments</a></li>
<li><a href="#_configuring_environments">4.4. Configuring environments</a></li>
</ul>
</li>
<li><a href="#_secrets_passwords_and_maven">5. Secrets/Passwords and Maven</a></li>
<li><a href="#_generating_data">6. Generating data?</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="_talend_components_definitions_documentation" class="sect0">Talend Components Definitions Documentation</h1>
<div class="sect1">
<h2 id="_components_definitions">1. Components Definitions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Talend Component framework relies on several primitive components.</p>
</div>
<div class="paragraph">
<p>They can all use <code>@PostConstruct</code> and <code>@PreDestroy</code> to initialize/release
some underlying resource at the beginning/end of the processing.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
in distributed environments class' constructor will be called on cluster manager node, methods annotated with
<code>@PostConstruct</code> and <code>@PreDestroy</code> annotations will be called on worker nodes. Thus, partition plan computation and pipeline task
will be performed on different nodes.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/generated-deployment-diagram.png" alt="generated deployment diagram" width="490" height="392">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Created task consists of Jar file, containing class, which describes pipeline(flow) which should be processed in cluster.</p>
</li>
<li>
<p>During partition plan computation step pipeline is analyzed and split into stages. Cluster Manager node instantiates mappers/processors
gets estimated data size using mappers, splits created mappers according to the estimated data size. All instances are serialized and
sent to Worker nodes afterwards.</p>
</li>
<li>
<p>Serialized instances are received and deserialized, methods annotated with @PostConstruct annotation are called. After that,
pipeline execution is started. Processor&#8217;s @BeforeGroup annotated method is called before processing first element in chunk.
After processing number of records estimated as chunk size, Processor&#8217;s @AfterGroup annotated method called. Chunk size is calculated
depending on environment the pipeline is processed by. After pipeline is processed, methods annotated with @PreDestroy annotation are called.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/generated-driver-processing-workflow.png" alt="generated driver processing workflow" width="330" height="266">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/generated-worker-processing-workflow.png" alt="generated worker processing workflow" width="240" height="476">
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
all framework managed methods <code>MUST</code> be public too. Private methods are ignored.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
in term of design the framework tries to be as declarative as possible but also to stay extensible
not using fixed interfaces or method signatures. This will allow to add incrementally new features of the underlying implementations.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_partitionmapper">1.1. PartitionMapper</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A <code>PartitionMapper</code> is a component able to split itself to
make the execution more efficient.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This concept is borrowed to big data world and useful only in this context (<code>BEAM</code> executions).
Overall idea is to divide the work before executing it to try to reduce the overall execution time.</p>
</div>
<div class="paragraph">
<p>The process is the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Estimate the size of the data you will work on. This part is often heuristic and not very precise.</p>
</li>
<li>
<p>From that size the execution engine (<em>runner</em> for beam) will request the mapper to split <em>itself</em> in <em>N</em> mappers with a subset of the overall work.</p>
</li>
<li>
<p>The <em>leaf</em> (final) mappers will be used as a <code>Producer</code> (actual reader) factory.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
this kind of component <code>MUST</code> be <code>Serializable</code> to be distributable.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_definition">1.1.1. Definition</h4>
<div class="paragraph">
<p>A partition mapper requires 3 methods marked with specific annotations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>@Assessor</code> for the evaluating method</p>
</li>
<li>
<p><code>@Split</code> for the dividing method</p>
</li>
<li>
<p><code>@Emitter</code> for the <code>Producer</code> factory</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_assessor">@Assessor</h5>
<div class="paragraph">
<p>The assessor method will return the estimated size of the data related to the component (depending its configuration).
It <code>MUST</code> return a <code>Number</code> and <code>MUST</code> not take any parameter.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Assessor</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">long</span> estimateDataSetByteSize() {
    <span style="color:#080;font-weight:bold">return</span> ....;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_split">@Split</h5>
<div class="paragraph">
<p>The split method will return a collection of partition mappers and can take optionally a <code>@PartitionSize</code> long
value which is the requested size of the dataset per sub partition mapper.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Split</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;MyMapper&gt; split(<span style="color:#007">@PartitionSize</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#339;font-weight:bold">long</span> desiredSize) {
    <span style="color:#080;font-weight:bold">return</span> ....;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_emitter">@Emitter</h5>
<div class="paragraph">
<p>The emitter method <code>MUST</code> not have any parameter and <code>MUST</code> return a producer. It generally uses the partition mapper configuration
to instantiate/configure the producer.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Emitter</span>
<span style="color:#088;font-weight:bold">public</span> MyProducer create() {
    <span style="color:#080;font-weight:bold">return</span> ....;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_producer">1.2. Producer</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A <code>Producer</code> is the component interacting with a physical source. It produces input data for the processing flow.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>A producer is a very simple component which <code>MUST</code> have a <code>@Producer</code> method without any parameter and returning any data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Producer</span>
<span style="color:#088;font-weight:bold">public</span> MyData produces() {
    <span style="color:#080;font-weight:bold">return</span> ...;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_processor">1.3. Processor</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A <code>Processor</code> is a component responsible to convert an incoming data to another model.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>A processor <code>MUST</code> have a method decorated with <code>@ElementListener</code> taking an incoming data and returning the processed data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ElementListener</span>
<span style="color:#088;font-weight:bold">public</span> MyNewData map(<span style="color:#088;font-weight:bold">final</span> MyData data) {
    <span style="color:#080;font-weight:bold">return</span> ...;
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
this kind of component <code>MUST</code> be <code>Serializable</code> since it is distributed.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
if you don&#8217;t care much of the type of the parameter and need to access data on a "map like" based rule set, then you can
use <code>JsonObject</code> as parameter type and Talend Component will just wrap the data to enable you to access it as a map. The parameter
type is not enforced, i.e. if you know you will get a <code>SuperCustomDto</code> then you can use that as parameter type but for generic
component reusable in any chain it is more than highly encouraged to use <code>JsonObject</code> until you have your an evaluation language
based processor (which has its own way to access component). Here is an example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ElementListener</span>
<span style="color:#088;font-weight:bold">public</span> MyNewData map(<span style="color:#088;font-weight:bold">final</span> JsonObject incomingData) {
    <span style="color:#0a8;font-weight:bold">String</span> name = incomingData.getString(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">name</span><span style="color:#710">&quot;</span></span>);
    <span style="color:#339;font-weight:bold">int</span> name = incomingData.getInt(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">age</span><span style="color:#710">&quot;</span></span>);
    <span style="color:#080;font-weight:bold">return</span> ...;
}

<span style="color:#777">// equivalent to (using POJO subclassing)</span>

<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> age;
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">int</span> age;

    <span style="color:#777">// getters/setters</span>
}

<span style="color:#007">@ElementListener</span>
<span style="color:#088;font-weight:bold">public</span> MyNewData map(<span style="color:#088;font-weight:bold">final</span> Person person) {
    <span style="color:#0a8;font-weight:bold">String</span> name = person.getName();
    <span style="color:#339;font-weight:bold">int</span> name = person.getAge();
    <span style="color:#080;font-weight:bold">return</span> ...;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A processor also supports <code>@BeforeGroup</code> and <code>@AfterGroup</code> which <code>MUST</code> be methods without parameters and returning <code>void</code> (result would be ignored).
This is used by the runtime to mark a chunk of the data in a way which is estimated <em>good</em> for the execution flow size.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
this is estimated so you don&#8217;t have any guarantee on the size of a <em>group</em>. You can literally have groups of size 1.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The common usage is to batch records for performance reasons:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@BeforeGroup</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> initBatch() {
    <span style="color:#777">// ...</span>
}

<span style="color:#007">@AfterGroup</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> endBatch() {
    <span style="color:#777">// ...</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
it is a good practise to support a <code>maxBatchSize</code> here and potentially commit before the end of the group in case
of a computed size which is way too big for your backend.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_multiple_outputs">1.4. Multiple outputs</h3>
<div class="paragraph">
<p>In some case you may want to split the output of a processor in two. A common example is "main" and "reject" branches
where part of the incoming data are put in a specific bucket to be processed later.</p>
</div>
<div class="paragraph">
<p>This can be done using <code>@Output</code>. This can be used as a replacement of the returned value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ElementListener</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> map(<span style="color:#088;font-weight:bold">final</span> MyData data, <span style="color:#007">@Output</span> <span style="color:#088;font-weight:bold">final</span> OutputEmitter&lt;MyNewData&gt; output) {
    output.emit(createNewData(data));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can pass it a string which will represent the new branch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ElementListener</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> map(<span style="color:#088;font-weight:bold">final</span> MyData data,
                <span style="color:#007">@Output</span> <span style="color:#088;font-weight:bold">final</span> OutputEmitter&lt;MyNewData&gt; main,
                <span style="color:#007">@Output</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">rejected</span><span style="color:#710">&quot;</span></span>) <span style="color:#088;font-weight:bold">final</span> OutputEmitter&lt;MyNewDataWithError&gt; rejected) {
    <span style="color:#080;font-weight:bold">if</span> (isRejected(data)) {
        rejected.emit(createNewData(data));
    } <span style="color:#080;font-weight:bold">else</span> {
        main.emit(createNewData(data));
    }
}

<span style="color:#777">// or simply</span>

<span style="color:#007">@ElementListener</span>
<span style="color:#088;font-weight:bold">public</span> MyNewData map(<span style="color:#088;font-weight:bold">final</span> MyData data,
                    <span style="color:#007">@Output</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">rejected</span><span style="color:#710">&quot;</span></span>) <span style="color:#088;font-weight:bold">final</span> OutputEmitter&lt;MyNewDataWithError&gt; rejected) {
    <span style="color:#080;font-weight:bold">if</span> (isSuspicious(data)) {
        rejected.emit(createNewData(data));
        <span style="color:#080;font-weight:bold">return</span> createNewData(data); <span style="color:#777">// in this case we continue the processing anyway but notified another channel</span>
    }
    <span style="color:#080;font-weight:bold">return</span> createNewData(data);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_multiple_inputs">1.5. Multiple inputs</h3>
<div class="paragraph">
<p>Having multiple inputs is closeto the output case excep it doesn&#8217;t require a wrapper <code>OutputEmitter</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ElementListener</span>
<span style="color:#088;font-weight:bold">public</span> MyNewData map(<span style="color:#007">@Input</span> <span style="color:#088;font-weight:bold">final</span> MyData data, <span style="color:#007">@Input</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">input2</span><span style="color:#710">&quot;</span></span>) <span style="color:#088;font-weight:bold">final</span> MyData2 data2) {
    <span style="color:#080;font-weight:bold">return</span> createNewData(data1, data2);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Input</code> takes the input name as parameter, if not set it uses the main (default) input branch.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
due to the work required to not use the default branch it is recommanded to use it when possible and not
name its branches depending on the component semantic.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_output">1.5.1. Output</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>An <code>Output</code> is a <code>Processor</code> returning no data.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Conceptually an output is a listener of data. It perfectly matches the concept of processor. Being the last of the execution chain
or returning no data will make your processor an output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ElementListener</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> store(<span style="color:#088;font-weight:bold">final</span> MyData data) {
    <span style="color:#777">// ...</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_combiners">1.6. Combiners?</h3>
<div class="paragraph">
<p>For now Talend Component doesn&#8217;t enable you to define a <code>Combiner</code>. It would be the symmetric part of the partition mapper
and allow to aggregate results in a single one.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_component">2. Configuring component</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Component are configured through their constructor parameters. They can all be marked with <code>@Option</code>
which will let you give a name to parameters (if not it will use the bytecode name which can require you to compile with <code>-parameter</code> flag
to not have <code>arg0</code>, <code>arg1</code>, &#8230;&#8203; as names).</p>
</div>
<div class="paragraph">
<p>The parameter types can be <em>primitives</em> or complex objects with fields decorated with <code>@Option</code> exactly like method parameters.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
it is recommanded to use simple models which can be serialized by components to avoid headaches when implementing serialized components.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">FileFormat</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Serializable</span> {
    <span style="color:#007">@Option</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">type</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">private</span> FileType type = FileType.CSV;

    <span style="color:#007">@Option</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">max-records</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">int</span> maxRecords = <span style="color:#00D">1024</span>;
}

<span style="color:#007">@PartitionMapper</span>(family = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">demo</span><span style="color:#710">&quot;</span></span>, name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file-reader</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> MyFileReader(<span style="color:#007">@Option</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file-path</span><span style="color:#710">&quot;</span></span>) <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">File</span> file,
                    <span style="color:#007">@Option</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file-format</span><span style="color:#710">&quot;</span></span>) <span style="color:#088;font-weight:bold">final</span> FileFormat format) {
    <span style="color:#777">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this kind of API makes the configuration extensible and component oriented letting the user define all he needs.</p>
</div>
<div class="paragraph">
<p>The instantiation of the parameters is done from the properties passed to the component (see next part).</p>
</div>
<div class="sect2">
<h3 id="_primitives">2.1. Primitives</h3>
<div class="paragraph">
<p>What is considered as a primitive in this mecanism is a class which can be directly converted from a <code>String</code> to the expected type.</p>
</div>
<div class="paragraph">
<p>It obviously includes all java primitives, <code>String</code> type itself but also all the types with a <code>org.apache.xbean.propertyeditor.Converter</code>.</p>
</div>
<div class="paragraph">
<p>This includes out of the box:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BigDecimal</code></p>
</li>
<li>
<p><code>BigInteger</code></p>
</li>
<li>
<p><code>File</code></p>
</li>
<li>
<p><code>InetAddress</code></p>
</li>
<li>
<p><code>ObjectName</code></p>
</li>
<li>
<p><code>URI</code></p>
</li>
<li>
<p><code>URL</code></p>
</li>
<li>
<p><code>Pattern</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_complex_object_mapping">2.2. Complex object mapping</h3>
<div class="paragraph">
<p>The conversion from properties to object is using the dotted notation. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">file.path = /home/user/input.csv
file.format = CSV</code></pre>
</div>
</div>
<div class="paragraph">
<p>will match</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">FileOptions</span> {
    <span style="color:#007">@Option</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">path</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">File</span> path;

    <span style="color:#007">@Option</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">format</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Format</span> format;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>assuming the method parameter was configured with <code>@Option("file")</code>.</p>
</div>
<div class="sect3">
<h4 id="_list_case">2.2.1. List case</h4>
<div class="paragraph">
<p>Lists use the same syntax but to define their elements their rely on an indexed syntax. Assuming the list parameter is named <code>files</code>
and the elements are of  <code>FileOptions</code> type, here is how to define a list of 2 elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">files[0].path = /home/user/input1.csv
files[0].format = CSV
files[1].path = /home/user/input2.xml
files[2].format = EXCEL</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_map_case">2.2.2. Map case</h4>
<div class="paragraph">
<p>Inspired from the list case, the map uses <code>.key[index]</code> and <code>.value[index]</code> to represent its key and values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">// Map&lt;String, FileOptions&gt;
files.key[0] = first-file
files.value[0].path = /home/user/input1.csv
files.value[0].type = CSV
files.key[1] = second-file
files.value[1].path = /home/user/input2.xml
files.value[1].type = EXCEL</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">// Map&lt;FileOptions, String&gt;
files.key[0].path = /home/user/input1.csv
files.key[0].type = CSV
files.value[0] = first-file
files.key[1].path = /home/user/input2.xml
files.key[1].type = EXCEL
files.value[1] = second-file</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
don&#8217;t abuse of map type. If not needed for your configuration (= if you can configure your component
with an object) don&#8217;t use it.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_constraints_and_validation_on_the_configuration_input">2.3. Constraints and validation on the configuration/input</h3>
<div class="paragraph">
<p>It is common to need to add as metadata a field is required, another has a minimum size etc. This is done with the
validation in <code>org.talend.sdk.component.api.configuration.constraint</code> package:</p>
</div>
<table class="tableblock frame-all grid-all table-striped table-hover table-ordered">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Parameter Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Supported Types</th>
<th class="tableblock halign-left valign-top">Metadata sample</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxLength</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure the decorated option size is validated with a higher bound.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CharSequence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::maxLength":"12.34"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">minLength</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure the decorated option size is validated with a lower bound.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CharSequence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::minLength":"12.34"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validate the decorated string with a java pattern, you can use xregex library in javascript.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CharSequence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::pattern":"test"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure the decorated option size is validated with a higher bound.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number, int, short, byte, long, double, float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::max":"12.34"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure the decorated option size is validated with a lower bound.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number, int, short, byte, long, double, float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::min":"12.34"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark the field as being mandatory.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::required":"true"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxItems</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure the decorated option size is validated with a higher bound.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::maxItems":"12.34"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">minItems</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure the decorated option size is validated with a lower bound.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::minItems":"12.34"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Uniques</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uniqueItems</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure the elements of the collection must be distinct (kind of set).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::uniqueItems":"true"}</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
using the programmatic API the metadata are prefixed by <code>tcomp::</code> but this prefix is stripped in the web for convenience,
the previous table uses the web keys.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_marking_a_configuration_as_a_particular_type_of_data">2.4. Marking a configuration as a particular type of data</h3>
<div class="paragraph">
<p>It is common to classify the incoming data. You can see it as tagging them in several types. The most common ones
are the:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>datastore: all the data you need to connect to the backend</p>
</li>
<li>
<p>dataset: a datastore coupled with all the data you need to execute an action</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all table-striped table-hover table-ordered">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Metadata sample</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.talend.sdk.component.api.configuration.type.DataStore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datastore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a model (complex object) as being a datastore (connection to a backend).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"tcomp::configurationtype::type":"datastore","tcomp::configurationtype::name":"test"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.talend.sdk.component.api.configuration.type.DataSet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dataset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a model (complex object) as being a dataset.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"tcomp::configurationtype::type":"dataset","tcomp::configurationtype::name":"test"}</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
the component family associated with a configuration type (datastore/dataset) is always the one related
to the component using that configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Those configuration types can be composed to provide one configuration item. For example a dataset type will often need a datastore
type to be provided. and a datastore type (that provides the connection information) will be used to create a dataset type.</p>
</div>
<div class="paragraph">
<p>Those configuration types will also be used at design time to create shared configuration that can be stored and used at runtime.</p>
</div>
<div class="paragraph">
<p>For example, we can think about a relational database that support JDBC:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A datastore may provide:</p>
<div class="ulist">
<ul>
<li>
<p>jdbc url, username, password</p>
</li>
</ul>
</div>
</li>
<li>
<p>A dataset may be:</p>
<div class="ulist">
<ul>
<li>
<p>datastore (that will provide the connection data to the database)</p>
</li>
<li>
<p>table name, data []</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The component server will scan all those configuration types and provide a configuration type index. This index can be used for the integration
into the targeted platforms (studio, web applications&#8230;&#8203;)</p>
</div>
<div class="paragraph">
<p>The configuration type index is represented as a flat tree that contains all the configuration types represented as nodes and indexed by their ids.</p>
</div>
<div class="paragraph">
<p>Also, every node can point to other nodes. This relation is represented as an array of edges that provide the childes ids.</p>
</div>
<div class="paragraph">
<p>For example, a configuration type index for the above example will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span style="color:#F00;background-color:#FAA">n</span><span style="color:#F00;background-color:#FAA">o</span><span style="color:#F00;background-color:#FAA">d</span><span style="color:#F00;background-color:#FAA">e</span><span style="color:#F00;background-color:#FAA">s</span>: {
             <span style="color:#606"><span style="color:#404">&quot;</span><span>idForDstore</span><span style="color:#404">&quot;</span></span>: { <span style="color:#F00;background-color:#FAA">d</span><span style="color:#F00;background-color:#FAA">a</span><span style="color:#F00;background-color:#FAA">t</span><span style="color:#F00;background-color:#FAA">a</span><span style="color:#F00;background-color:#FAA">s</span><span style="color:#F00;background-color:#FAA">t</span><span style="color:#F00;background-color:#FAA">o</span><span style="color:#F00;background-color:#FAA">r</span><span style="color:#F00;background-color:#FAA">e</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">datastore data</span><span style="color:#710">&quot;</span></span>, <span style="color:#F00;background-color:#FAA">e</span><span style="color:#F00;background-color:#FAA">d</span><span style="color:#F00;background-color:#FAA">g</span><span style="color:#F00;background-color:#FAA">e</span><span style="color:#F00;background-color:#FAA">s</span>:[<span style="color:#F00;background-color:#FAA">i</span><span style="color:#F00;background-color:#FAA">d</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">idForDset</span><span style="color:#710">&quot;</span></span>] },
             <span style="color:#606"><span style="color:#404">&quot;</span><span>idForDset</span><span style="color:#404">&quot;</span></span>:   { <span style="color:#F00;background-color:#FAA">d</span><span style="color:#F00;background-color:#FAA">a</span><span style="color:#F00;background-color:#FAA">t</span><span style="color:#F00;background-color:#FAA">a</span><span style="color:#F00;background-color:#FAA">s</span><span style="color:#F00;background-color:#FAA">e</span><span style="color:#F00;background-color:#FAA">t</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">dataset data</span><span style="color:#710">&quot;</span></span> }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_define_links_between_properties">2.5. Define links between properties</h3>
<div class="paragraph">
<p>It can be needed to define a binding between properties, a set of annotations allows to do it:</p>
</div>
<table class="tableblock frame-all grid-all table-striped table-hover table-ordered">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Metadata Sample</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.condition.ActiveIfs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ifs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to set multiple visibility conditions on the same property.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"condition::if::value::0":"value1,value2","condition::if::value::1":"SELECTED","condition::if::target::0":"sibling1","condition::if::target::1":"../../other"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.condition.ActiveIf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the evaluation of the element at the location matches value then the element is considered active, otherwise it is deactivated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"condition::if::target":"test","condition::if::value":"value1,value2"}</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Target element location is specified as a relative path to current location using Unix path characters.
Configuration class delimiter is <code>/</code>. Parent configuration class is specified by <code>..</code>.
Thus <code>../targetProperty</code> denotes a property, which is located in parent configuration class and has name <code>targetProperty</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
using the programmatic API the metadata are prefixed by <code>tcomp::</code> but this prefix is stripped in the web for convenience,
the previous table uses the web keys.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="documentation-ui-hints">2.6. Add hints about the rendering based on configuration/component knowledge</h3>
<div class="paragraph">
<p>In some case it can be needed to add some metadata about the configuration to let the UI render properly the configuration.
A simple example is a password value must be hidden and not a simple clear input box. For these cases - when the component developper
wants to influence the UI rendering - you can use a particular set of annotations:</p>
</div>
<table class="tableblock frame-all grid-all table-striped table-hover table-ordered">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Generated property metadata</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.DefaultValue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provide a default value the UI can use - only for primitive fields.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::defaultvalue::value":"test"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.OptionsOrder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to sort a class properties.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::optionsorder::value":"value1,value2"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.layout.AutoLayout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request the rendered to do what it thinks is best.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::autolayout":"true"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.layout.GridLayout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advanced layout to place properties by row, this is exclusive with <code>@OptionsOrder</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::gridlayout::value1::value":"first</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">second,third","ui::gridlayout::value2::value":"first</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">second,third"}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.layout.GridLayouts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow to configure multiple grid layouts on the same class, qualified with a classifier (name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::gridlayout::Advanced::value":"another","ui::gridlayout::Main::value":"first</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">second,third"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.layout.HorizontalLayout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Put on a configuration class it notifies the UI an horizontal layout is preferred.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::horizontallayout":"true"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.layout.VerticalLayout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Put on a configuration class it notifies the UI a vertical layout is preferred.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::verticallayout":"true"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.widget.Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a field as being represented by some code widget (vs textarea for instance).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::code::value":"test"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.widget.Credential</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a field as being a credential. It is typically used to hide the value in the UI.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::credential":"true"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.widget.Structure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a List&lt;String&gt; or Map&lt;String, String&gt; field as being represented as the component data selector (field names generally or field names as key and type as value).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::structure::type":"null","ui::structure::discoverSchema":"test","ui::structure::value":"test"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.widget.TextArea</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a field as being represented by a textarea(multiline text input).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::textarea":"true"}</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
using the programmatic API the metadata are prefixed by <code>tcomp::</code> but this prefix is stripped in the web for convenience,
the previous table uses the web keys.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
target support should cover <code>org.talend.core.model.process.EParameterFieldType</code> but we need to ensure web renderers is able to handle the same widgets.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gallery">3. Gallery</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_widgets">3.1. Widgets</h3>
<table class="tableblock frame-all grid-all table gallery">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Studio Rendering</th>
<th class="tableblock halign-left valign-top">Web Rendering</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input/Text</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Option</span>
<span style="color:#0a8;font-weight:bold">String</span> config;</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/studio/input.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/studio/input.png" alt="Studio Input"></a>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/web/input.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/web/input.png" alt="Web Input"></a>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Option</span>
<span style="color:#007">@Credential</span>
<span style="color:#0a8;font-weight:bold">String</span> config;</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/studio/password.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/studio/password.png" alt="Studio Password"></a>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/web/password.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/web/password.png" alt="Web Password"></a>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Textarea</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Option</span>
<span style="color:#007">@Textarea</span>
<span style="color:#0a8;font-weight:bold">String</span> config;</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/studio/textarea.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/studio/textarea.png" alt="Studio Textarea"></a>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/web/textarea.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/web/textarea.png" alt="Web Textarea"></a>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checkbox</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Option</span>
<span style="color:#0a8;font-weight:bold">Boolean</span> config;</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/studio/checkbox.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/studio/checkbox.png" alt="Studio Checkbox"></a>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/web/checkbox.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/web/checkbox.png" alt="Web Checkbox"></a>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Option</span>
<span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; config;</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/studio/list.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/studio/list.png" alt="Studio List"></a>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/web/list.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/web/list.png" alt="Web List"></a>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Table</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Option</span>
<span style="color:#0a8;font-weight:bold">Object</span> config;</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/studio/table.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/studio/table.png" alt="Studio Table"></a>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/web/table.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/web/table.png" alt="Web Table"></a>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Code</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">java</span><span style="color:#710">&quot;</span></span>)
<span style="color:#007">@Option</span>
<span style="color:#0a8;font-weight:bold">String</span> config;</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/studio/javaCode.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/studio/javaCode.png" alt="Studio Code"></a>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/web/javaCode.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/web/javaCode.png" alt="Web Code"></a>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Schema</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Option</span>
<span style="color:#007">@Structure</span>
<span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; config;</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/studio/schema.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/studio/schema.png" alt="Studio Schema"></a>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/web/schema.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/web/schema.png" alt="Web Schema"></a>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_validations">3.2. Validations</h3>
<table class="tableblock frame-all grid-all table gallery">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Studio Rendering</th>
<th class="tableblock halign-left valign-top">Web Rendering</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property validation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#777">/** configuration class */</span>
<span style="color:#007">@Option</span>
<span style="color:#007">@Validable</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">url</span><span style="color:#710">&quot;</span></span>)
<span style="color:#0a8;font-weight:bold">String</span> config;

<span style="color:#777">/** service class */</span>
<span style="color:#007">@AsyncValidation</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">url</span><span style="color:#710">&quot;</span></span>)
ValidationResult doValidate(<span style="color:#0a8;font-weight:bold">String</span> url) {
}</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/studio/prop_validation.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/studio/validation_property.png" alt="Studio Code"></a>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/web/prop_validation.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/web/validation_property.png" alt="Web Code"></a>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data store validation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Datastore</span>
<span style="color:#007">@Checkable</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">config</span> {
<span style="color:#777">/** config ...*/</span>
}

<span style="color:#777">/** service class */</span>
<span style="color:#007">@HealthCheck</span>
<span style="color:#088;font-weight:bold">public</span> HealthCheckStatus testConnection(){

}</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/studio/prop_validation.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/studio/validation_datastore.png" alt="Studio Code"></a>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<a class="image" href="images/gallery/widgets/web/prop_validation.png" target="_blank" rel="noopener"><img src="images/gallery/widgets/web/validation_datastore.png" alt="Web Code"></a>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_registering_components">4. Registering components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As seen in the <a href="getting-started.html#getting-started-first-quick-start">Getting Started</a>, you need an annotation to register
your component through <code>family</code> method. Multiple components can use the same <code>family</code> value but the pair <code>family</code>+<code>name</code>
<code>MUST</code> be unique for the system.</p>
</div>
<div class="paragraph">
<p>If you desire (recommended) to share the same component family name instead of repeating yourself in all <code>family</code> methods,
you can use <code>@Components</code> annotation on the root package of you component, it will enable you to define the component family and
the categories the component belongs to (default is <code>Misc</code> if not set). Here is a sample <code>package-info.java</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Components</span>(name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my_component_family</span><span style="color:#710">&quot;</span></span>, categories = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">My Category</span><span style="color:#710">&quot;</span></span>)
<span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">org.talend.sdk.component.sample</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.talend.sdk.component.api.component.Components</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For an existing component it can look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Components</span>(name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Salesforce</span><span style="color:#710">&quot;</span></span>, categories = {<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Business</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Cloud</span><span style="color:#710">&quot;</span></span>})
<span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">org.talend.sdk.component.sample</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.talend.sdk.component.api.component.Components</span>;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_components_metadata">4.1. Components metadata</h3>
<div class="paragraph">
<p>Components can require a few metadata to be integrated in Talend Studio or Cloud platform. Here is how to provide these information.
These metadata are set on the component class and belongs to <code>org.talend.sdk.component.api.component</code> package.</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Icon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set an icon key used to represent the component. Note you can use a custom key with <code>custom()</code> method but it is not guaranteed the icon will be rendered properly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the component version, default to 1.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Icon</span>(FILE_XML_O)
<span style="color:#007">@PartitionMapper</span>(name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jaxbInput</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">JaxbPartitionMapper</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Serializable</span> {
    <span style="color:#777">// ...</span>
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_management_of_configuration_versions">4.1.1. Management of configuration versions</h4>
<div class="paragraph">
<p>If some impacting changes happen on the configuration they can be manage through a migration handler at <strong>component</strong> level (to enable
to support trans-model migration).</p>
</div>
<div class="paragraph">
<p>The <code>@Version</code> annotation supports a <code>migrationHandler</code> method which will take the implementation migrating the incoming configuration
to the current model.</p>
</div>
<div class="paragraph">
<p>For instance if <code>filepath</code> configuration entry from v1 changed to <code>location</code> in v2 you can remap the value to the right key in your
<code>MigrationHandler</code> implementation.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
it is recommanded to not manage all migrations in the handler but rather split it in services you inject in the migration handler
(through constructor):
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#777">// full component code structure skipped for brievity, kept only migration part</span>
<span style="color:#007">@Version</span>(value = <span style="color:#00D">3</span>, migrationHandler = MyComponent.Migrations.class)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyComponent</span> {
    <span style="color:#777">// the component code...</span>


    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">interface</span> <span style="color:#B06;font-weight:bold">VersionConfigurationHandler</span> {
        <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; migrate(<span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; incomingData);
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Migrations</span> {
        <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;VersionConfigurationHandler&gt; handlers;

        <span style="color:#777">// VersionConfigurationHandler implementations are decorated with @Service</span>
        <span style="color:#088;font-weight:bold">public</span> Migrations(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;VersionConfigurationHandler&gt; migrations) {
            <span style="color:#950">this</span>.handlers = migrations;
            <span style="color:#950">this</span>.handlers.sort(<span style="color:#777">/*some custom logic*/</span>);
        }

        <span style="color:#007">@Override</span>
        <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; migrate(<span style="color:#339;font-weight:bold">int</span> incomingVersion, <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; incomingData) {
            <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; out = incomingData;
            <span style="color:#080;font-weight:bold">for</span> (MigrationHandler handler : handlers) {
                out = handler.migrate(out);
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>What is important in this snippet is not much the way the code is organized but rather the fact you organize your migrations the way which fits the best
your component. If migrations are not conflicting no need of something fancy, just apply them all but if you need to apply them in order
you need to ensure they are sorted. Said otherwise: don&#8217;t see this API as a migration API but as a migration callback
and adjust the migration code structure you need behind the <code>MigrationHandler</code> based on your
component requirements. The service injection enables you to do so.</p>
</div>
</div>
<div class="sect3">
<h4 id="_partitionmapper_2">4.1.2. @PartitionMapper</h4>
<div class="paragraph">
<p><code>@PartitionMapper</code> will obviously mark a partition mapper:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@PartitionMapper</span>(family = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">demo</span><span style="color:#710">&quot;</span></span>, name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my_mapper</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyMapper</span> {
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_emitter_2">@Emitter</h5>
<div class="paragraph">
<p><code>@Emitter</code> is a shortcut for <code>@PartitionMapper</code> when you don&#8217;t support distribution. Said otherwise it will enforce an implicit
partition mapper execution with an assessor size of 1 and a split returning itself.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Emitter</span>(family = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">demo</span><span style="color:#710">&quot;</span></span>, name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my_input</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyInput</span> {
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_processor_2">4.1.3. @Processor</h4>
<div class="paragraph">
<p>A method decorated with <code>@Processor</code> will be considered as a producer factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Processor</span>(family = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">demo</span><span style="color:#710">&quot;</span></span>, name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my_processor</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyProcessor</span> {
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_internationalization">5. Internationalization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the simplest case you should store messages using <code>ResourceBundle</code> properties file in your component module to use internationalization.
The location of the properties file should be in the same package as the related component(s) and is named <code>Messages</code> (ex: <code>org.talend.demo.MyComponent</code> will use <code>org.talend.demo.Messages[locale].properties</code>).</p>
</div>
<div class="sect2">
<h3 id="_default_components_keys">5.1. Default components keys</h3>
<div class="paragraph">
<p>Out of the box components are internationalized using the same location logic for the resource bundle and here is the list
of supported keys:</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name Pattern</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${family}._displayName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the display name of the family</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${family}.${configurationType}.${name}._displayName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the display name of a configuration type (dataStore or dataSet)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${family}.${component_name}._displayName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the display name of the component (used by the GUIs)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${property_path}._displayName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the display name of the option.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${simple_class_name}.${property_name}._displayName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the display name of the option using it class name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${property_path}._placeholder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the placeholder of the option.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example of configuration for a component named <code>list</code> belonging to the family <code>memory</code> (<code>@Emitter(family = "memory", name = "list")</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>memory.list._displayName = Memory List</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configuration class are also translatable using the simple class name in the messages properties file.
This useful when you have some common configuration shared within multiple components.</p>
</div>
<div class="paragraph">
<p>If you have a configuration class like :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyConfig</span> {

    <span style="color:#007">@Option</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> host;

    <span style="color:#007">@Option</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">int</span> port;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can give it a translatable display name by adding ${simple_class_name}.${property_name}._displayName to Messages.properties under the same package as the config class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>MyConfig.host._displayName = Server Host Name
MyConfig.host._placeholder = Enter Server Host Name...

MyConfig.port._displayName = Server Port
MyConfig.port._placeholder = Enter Server Port...</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you have a display name using the property path, it will override the display name defined using the simple class name.
this rule apply also to placeholders
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<h1 id="_components_packaging" class="sect0">Components Packaging</h1>
<div class="sect1">
<h2 id="_component_loading">1. Component loading</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Talend Component scanning is based on a plugin concept. To ensure plugins can be developped in parallel and avoid conflicts
it requires to isolate plugins (components or component grouped in a single jar/plugin).</p>
</div>
<div class="paragraph">
<p>Here we have multiple options which are (high level):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>flat classpath: listed for completeness but rejected <em>by design</em> because it doesn&#8217;t match at all this requirement.</p>
</li>
<li>
<p>tree classloading: a shared classloader inherited by plugin classloaders but plugin classloader classes
are not seen by the shared classloader nor by other plugins.</p>
</li>
<li>
<p>graph classloading: this one allows you to link the plugins and dependencies together dynamically in any direction.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want to map it to concrete common examples, the tree classloading is commonly used by Servlet containers where plugins are web applications
and the graph classloading can be illustrated by OSGi containers.</p>
</div>
<div class="paragraph">
<p>In the spirit of avoiding a lot of complexity added by this layer, Talend Component relies on a tree classloading. The advantage
is you don&#8217;t need to define the relationship with other plugins/dependencies (it is built-in).</p>
</div>
<div class="paragraph">
<p>Here is a representation of this solution:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/generated-classloader-layout.png" alt="generated classloader layout" width="480" height="168">
</div>
</div>
<div class="paragraph">
<p>The interesting part is the <em>shared</em> area will contain Talend Component API which is the only (by default) shared classes accross the whole plugins.</p>
</div>
<div class="paragraph">
<p>Then each plugins will be loaded in their own classloader with their dependencies.</p>
</div>
<div class="sect2">
<h3 id="_packaging_a_plugin">1.1. Packaging a plugin</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
this part explains the overall way to handle dependecnies but the Talend Maven plugin provides a shortcut for that.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A plugin is just a jar which was enriched with the list of its dependencies. By default Talend Component runtime is able to
read the output of <code>maven-dependency-plugin</code> in <code>TALEND-INF/dependencies.txt</code> location so you just need to ensure your component defines the following plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>maven-dependency-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>3.0.2<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>create-TALEND-INF/dependencies.txt<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>process-resources<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>list<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;outputFile&gt;</span>${project.build.outputDirectory}/TALEND-INF/dependencies.txt<span style="color:#070;font-weight:bold">&lt;/outputFile&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you check your jar once built you will see that the file contains something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ unzip -p target/mycomponent-1.0.0-SNAPSHOT.jar TALEND-INF/dependencies.txt

The following files have been resolved:
   org.talend.sdk.component:component-api:jar:1.0.0-SNAPSHOT:provided
   org.apache.geronimo.specs:geronimo-annotation_1.3_spec:jar:1.0:provided
   org.superbiz:awesome-project:jar:1.2.3:compile
   junit:junit:jar:4.12:test
   org.hamcrest:hamcrest-core:jar:1.3:test</code></pre>
</div>
</div>
<div class="paragraph">
<p>What is important to see is the scope associated to the artifacts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the API (<code>component-api</code> and <code>geronimo-annotation_1.3_spec</code>) are <code>provided</code> because you can consider them to be there when executing (it comes with the framework)</p>
</li>
<li>
<p>your specific dependencies (<code>awesome-project</code>) is <code>compile</code>: it will be included as a needed dependency by the framework (note that using <code>runtime</code> works too).</p>
</li>
<li>
<p>the other dependencies will be ignored (<code>test</code> dependencies)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_packaging_an_application">1.2. Packaging an application</h3>
<div class="paragraph">
<p>Even if a flat classpath deployment is possible, it is not recommanded because it would then reduce the capabilities of the components.</p>
</div>
<div class="sect3">
<h4 id="_dependencies">1.2.1. Dependencies</h4>
<div class="paragraph">
<p>The way the framework resolves dependencies is based on a local maven repository layout. As a quick reminder it looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>.
├── groupId1
│   └── artifactId1
│       ├── version1
│       │   └── artifactId1-version1.jar
│       └── version2
│           └── artifactId1-version2.jar
└── groupId2
    └── artifactId2
        └── version1
            └── artifactId2-version1.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is all the layout the framework will use. Concretely the logic will convert the t-uple {groupId, artifactId, version, type (jar)}
to the path in the repository.</p>
</div>
<div class="paragraph">
<p>Talend Component runtime has two ways to find an artifact:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>from the file system based on a configure maven 2 repository.</p>
</li>
<li>
<p>from a fatjar (uber jar) with a nested maven repository under <code>MAVEN-INF/repository</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first option will use either - by default - <code>${user.home}/.m2/repository</code> or a specific path configured when creating a <code>ComponentManager</code>.
The nested repository option will need some configuration during the packaging to ensure the repository is well created.</p>
</div>
<div class="sect4">
<h5 id="_create_a_nested_maven_repository_with_maven_shade_plugin">Create a nested maven repository with maven-shade-plugin</h5>
<div class="paragraph">
<p>To create the nested <code>MAVEN-INF/repository</code> repository you can use <code>nested-maven-repository</code> extension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>maven-shade-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>3.0.0<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>package<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>shade<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;transformers&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;transformer</span> <span style="color:#b48">implementation</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component.container.maven.shade.ContainerDependenciesTransformer</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;session&gt;</span>${session}<span style="color:#070;font-weight:bold">&lt;/project&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;/transformer&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/transformers&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;dependencies&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>nested-maven-repository<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${the.plugin.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/dependencies&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_listing_needed_plugins">1.2.2. Listing needed plugins</h4>
<div class="paragraph">
<p>Plugin are programmatically registered in general but if you want to make some of them automatically available you
need to generate a <code>TALEND-INF/plugins.properties</code> which will map a plugin name to coordinates found with the maven mecanism
we just talked about.</p>
</div>
<div class="paragraph">
<p>Here again we can enrich <code>maven-shade-plugin</code> to do it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>maven-shade-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>3.0.0<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>package<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>shade<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;transformers&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;transformer</span> <span style="color:#b48">implementation</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component.container.maven.shade.PluginTransformer</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;session&gt;</span>${session}<span style="color:#070;font-weight:bold">&lt;/project&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;/transformer&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/transformers&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;dependencies&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>nested-maven-repository<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${the.plugin.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/dependencies&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_code_maven_shade_plugin_code_extensions">1.2.3. <code>maven-shade-plugin</code> extensions</h4>
<div class="paragraph">
<p>Here is a final job/application bundle based on maven shade plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>maven-shade-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>3.0.0<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;createDependencyReducedPom&gt;</span>false<span style="color:#070;font-weight:bold">&lt;/createDependencyReducedPom&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;filters&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;filter&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;artifact&gt;</span><strong>:</strong><span style="color:#070;font-weight:bold">&lt;/artifact&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;excludes&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;exclude&gt;</span>META-INF/<strong>.SF<span style="color:#070;font-weight:bold">&lt;/exclude&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;exclude&gt;</span>META-INF/</strong>.DSA<span style="color:#070;font-weight:bold">&lt;/exclude&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;exclude&gt;</span>META-INF/*.RSA<span style="color:#070;font-weight:bold">&lt;/exclude&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/excludes&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/filter&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/filters&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>package<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>shade<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;shadedClassifierName&gt;</span>shaded<span style="color:#070;font-weight:bold">&lt;/shadedClassifierName&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;transformers&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;transformer</span>
              <span style="color:#b48">implementation</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component.container.maven.shade.ContainerDependenciesTransformer</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;session&gt;</span>${session}<span style="color:#070;font-weight:bold">&lt;/session&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;userArtifacts&gt;</span>
              <span style="color:#070;font-weight:bold">&lt;artifact&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>sample-component<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;version&gt;</span>1.0<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;type&gt;</span>jar<span style="color:#070;font-weight:bold">&lt;/type&gt;</span>
              <span style="color:#070;font-weight:bold">&lt;/artifact&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;/userArtifacts&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;/transformer&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;transformer</span> <span style="color:#b48">implementation</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component.container.maven.shade.PluginTransformer</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;session&gt;</span>${session}<span style="color:#070;font-weight:bold">&lt;/session&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;userArtifacts&gt;</span>
              <span style="color:#070;font-weight:bold">&lt;artifact&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>sample-component<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;version&gt;</span>1.0<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;type&gt;</span>jar<span style="color:#070;font-weight:bold">&lt;/type&gt;</span>
              <span style="color:#070;font-weight:bold">&lt;/artifact&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;/userArtifacts&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;/transformer&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/transformers&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;dependencies&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>nested-maven-repository-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${the.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/dependencies&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the configuration unrelated to transformers can depend your application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>ContainerDependenciesTransformer</code> is the one to embed a maven repository and <code>PluginTransformer</code> to create a file listing (one per line)
a list of artifacts (representing plugins).</p>
</div>
<div class="paragraph">
<p>Both transformers share most of their configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>session</code>: must be set to <code>${session}</code>. This is used to retrieve dependencies.</p>
</li>
<li>
<p><code>scope</code>: a comma separated list of scope to include in the artifact filtering (note that the default will rely on <code>provided</code> but you can replace it by <code>compile</code>, <code>runtime</code>, <code>runtime+compile</code>, <code>runtime+system</code>, <code>test</code>).</p>
</li>
<li>
<p><code>include</code>: a comma separated list of artifact to include in the artifact filtering.</p>
</li>
<li>
<p><code>exclude</code>: a comma separated list of artifact to exclude in the artifact filtering.</p>
</li>
<li>
<p><code>userArtifacts</code>: a list of artifacts (groupId, artifactId, version, type - optional, file - optional for plugin transformer, scope - optional) which can be forced inline - mainly useful for <code>PluginTransformer</code>.</p>
</li>
<li>
<p><code>includeTransitiveDependencies</code>: should transitive dependencies of the components be included, true by default.</p>
</li>
<li>
<p><code>includeProjectComponentDependencies</code>: should project component dependencies be included, false by default (normally a job project uses isolation for components so this is not needed).</p>
</li>
<li>
<p><code>userArtifacts</code>: set of component artifacts to include.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
to use with the component tooling, it is recommended to keep default locations. Also if you feel you need to use project dependencies,
you can need to refactor your project structure to ensure you keep component isolation. Talend component let you handle that part but the recommended
practise is to use <code>userArtifacts</code> for the components and not the project <code>&lt;dependencies&gt;</code>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_containerdependenciestransformer">ContainerDependenciesTransformer</h5>
<div class="paragraph">
<p><code>ContainerDependenciesTransformer</code> specific configuration is the following one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>repositoryBase</code>: base repository location (default to <code>MAVEN-INF/repository</code>).</p>
</li>
<li>
<p><code>ignoredPaths</code>: a comma separated list of folder to not create in the output jar, this is common for the ones already created by other transformers/build parts.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_plugintransformer">PluginTransformer</h5>
<div class="paragraph">
<p><code>ContainerDependenciesTransformer</code> specific configuration is the following one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pluginListResource</code>: base repository location (default to TALEND-INF/plugins.properties`).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example: if you want to list only the plugins you use you can configure this transformer like that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;transformer</span> <span style="color:#b48">implementation</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component.container.maven.shade.PluginTransformer</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;session&gt;</span>${session}<span style="color:#070;font-weight:bold">&lt;/session&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;include&gt;</span>org.talend.sdk.component:component-x,org.talend.sdk.component:component-y,org.talend.sdk.component:component-z<span style="color:#070;font-weight:bold">&lt;/include&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/transformer&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="_build_tools" class="sect0">Build tools</h1>
<div class="sect1">
<h2 id="_maven_plugin">1. Maven Plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>talend-component-maven-plugin</code> intends to help you to write components
validating components match best practices and also generating transparently metadata used by Talend Studio.</p>
</div>
<div class="paragraph">
<p>Here is how to use it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this plugin is also an extension so you can declare it in your <code>build/extensions</code> block as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;extension&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Used as an extension, <code>dependencies</code>, <code>validate</code> and <code>documentation</code> goals will be set up.</p>
</div>
<div class="sect2">
<h3 id="_dependencies_2">1.1. Dependencies</h3>
<div class="paragraph">
<p>The first goal is a shortcut for the <code>maven-dependency-plugin</code>, it will create the <code>TALEND-INF/dependencies.txt</code> file
with the <code>compile</code> and <code>runtime</code> dependencies to let the component use it at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>talend-dependencies<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>dependencies<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_validate">1.2. Validate</h3>
<div class="paragraph">
<p>The most important goal is here to help you to validate the common programming model of the component. Here is the execution definition to activate it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>talend-component-validate<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>validate<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default it will be bound to <code>process-classes</code> phase. When executing it will do several validations which can be switched off
adding the corresponding flags to <code>false</code> in the <code>&lt;configuration&gt;</code> block of the execution:</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateInternationalization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validates resource bundle are presents and contain commonly used keys (like <code>_displayName</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateModel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure components pass validations of the <code>ComponentManager</code> and Talend Component runtime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateSerializable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure components are <code>Serializable</code> - note this is a sanity check, the component is not actually serialized here, if you have a doubt ensure to test it. It also checks any <code>@Internationalized</code> class is valid and has its keys.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateMetadata</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure components define an <code>@Icon</code> and <code>@Version</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateDataStore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure any  <code>@DataStore</code> defines a <code>@HealthCheck</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateComponent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure native programming model is respected, you can disable it when using another programming model like in beam case.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateActions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validate actions signatures for the ones not tolerating dynamic binding (<code>@HealthCheck</code>, <code>@DynamicValues</code>, &#8230;&#8203;). It is recommanded to keep it <code>true</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateFamily</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validate the family, i.e. the package containing the <code>@Components</code> has also a <code>@Icon</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateDocumentation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure all 1. components and 2. <code>@Option</code> properties have a documentation using <code>@Documentation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_documentation">1.3. Documentation</h3>
<div class="paragraph">
<p>This goal generates an Asciidoc file documenting your component from the configuration model (<code>@Option</code>) and
<code>@Documentation</code> you can put on options and the component itself.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>talend-component-documentation<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>asciidoc<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">level</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Which level are the root title</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>2 which means <code>==</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">output</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Where to store the output, it is <strong>NOT</strong> recommended to change it</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>${classes}/TALEND-INF/documentation.adoc</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formats</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A map of the renderings to do, keys are the format (<code>pdf</code> or <code>html</code>) and values the output paths</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attributes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A map of asciidoctor attributes when formats is set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateDir / templateEngine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template configuration for the rendering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Document title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">${project.name}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attachDocumentations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the documentations (<code>.adoc</code>, and <code>formats</code> keys) should be attached to the project (and deployed)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
if you use the extension you can add the property <code>talend.documentation.htmlAndPdf</code> and set it to <code>true</code> in your project
to automatically get a html and PDF rendering of the documentation.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_render_your_documentation">1.3.1. Render your documentation</h4>
<div class="sect4">
<h5 id="_html">HTML</h5>
<div class="paragraph">
<p>To render the generated documentation you can use the Asciidoctor Maven plugin (or Gradle equivalent):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span> (1)
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${talend-component-kit.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>documentation<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>prepare-package<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>asciidoc<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span>
<span style="color:#070;font-weight:bold">&lt;plugin&gt;</span> (2)
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.asciidoctor<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>asciidoctor-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>1.5.6<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>doc-html<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>prepare-package<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>process-asciidoc<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;sourceDirectory&gt;</span>${project.build.outputDirectory}/TALEND-INF<span style="color:#070;font-weight:bold">&lt;/sourceDirectory&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;sourceDocumentName&gt;</span>documentation.adoc<span style="color:#070;font-weight:bold">&lt;/sourceDocumentName&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;outputDirectory&gt;</span>${project.build.directory}/documentation<span style="color:#070;font-weight:bold">&lt;/outputDirectory&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;backend&gt;</span>html5<span style="color:#070;font-weight:bold">&lt;/backend&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Will generate in <code>target/classes/TALEND-INF/documentation.adoc</code> the components documentation.</p>
</li>
<li>
<p>Will render the documenation as an html file in <code>target/documentation/documentation.html</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
ensure to execute it after the documentation generation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_pdf">PDF</h5>
<div class="paragraph">
<p>If you prefer a PDF rendering you can configure the following execution
in the asciidoctor plugin (note that you can configure both executions if you want
both HTML and PDF rendering):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.asciidoctor<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>asciidoctor-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>1.5.6<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>doc-html<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>prepare-package<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>process-asciidoc<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;sourceDirectory&gt;</span>${project.build.outputDirectory}/TALEND-INF<span style="color:#070;font-weight:bold">&lt;/sourceDirectory&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;sourceDocumentName&gt;</span>documentation.adoc<span style="color:#070;font-weight:bold">&lt;/sourceDocumentName&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;outputDirectory&gt;</span>${project.build.directory}/documentation<span style="color:#070;font-weight:bold">&lt;/outputDirectory&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;backend&gt;</span>pdf<span style="color:#070;font-weight:bold">&lt;/backend&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;dependencies&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.asciidoctor<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>asciidoctorj-pdf<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;version&gt;</span>1.5.0-alpha.16<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/dependencies&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_include_the_documentation_into_a_document">Include the documentation into a document</h5>
<div class="paragraph">
<p>If you want to add some more content or add a title, you can include the generated document into
another document using Asciidoc <code>include</code> directive.</p>
</div>
<div class="paragraph">
<p>A common example is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="adoc">= Super Components
Super Writer
:toc:
:toclevels: 3
:source-highlighter: prettify
:numbered:
:icons: font
:hide-uri-scheme:
:imagesdir: images

Unresolved directive in build-tools-maven.adoc - include::{generated_doc}/documentation.adoc[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This assumes you pass to the plugin the attribute <code>generated_doc</code>, this can be done this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.asciidoctor<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>asciidoctor-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>1.5.6<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>doc-html<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>prepare-package<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>process-asciidoc<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;sourceDirectory&gt;</span>${project.basedir}/src/main/asciidoc<span style="color:#070;font-weight:bold">&lt;/sourceDirectory&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;sourceDocumentName&gt;</span>my-main-doc.adoc<span style="color:#070;font-weight:bold">&lt;/sourceDocumentName&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;outputDirectory&gt;</span>${project.build.directory}/documentation<span style="color:#070;font-weight:bold">&lt;/outputDirectory&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;backend&gt;</span>html5<span style="color:#070;font-weight:bold">&lt;/backend&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;attributes&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;generated_adoc&gt;</span>${project.build.outputDirectory}/TALEND-INF<span style="color:#070;font-weight:bold">&lt;/generated_adoc&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/attributes&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is optional but allows to reuse maven placeholders to pass paths which is quite convenient in an automated build.</p>
</div>
</div>
<div class="sect4">
<h5 id="_more">More</h5>
<div class="paragraph">
<p>You can find more customizations on Asciidoctor <a href="http://asciidoctor.org/docs/asciidoctor-maven-plugin/">website</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_web">1.4. Web</h3>
<div class="paragraph">
<p>Testing the rendering of your component(s) configuration into the Studio is just a matter of deploying a component
in Talend Studio (you can have a look to link::studio.html[Studio Documentation] page. But don&#8217;t forget
the component can also be deployed into a Cloud (web) environment. To ease the testing of the related rendering,
you can use the goal <code>web</code> of the plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>mvn talend-component:web</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can test your component going on <a href="http://localhost:8080" class="bare">localhost:8080</a>. You need to select which component form you want
to see using the treeview on the left, then on the right the form will be displayed.</p>
</div>
<div class="paragraph">
<p>The two available configurations of the plugin are <code>serverPort</code> which is a shortcut to change the default, 8080, port
of the embedded server and <code>serverArguments</code> to pass Meecrowave options to the server. More on that configuration
is available at <a href="http://openwebbeans.apache.org/meecrowave/meecrowave-core/cli.html" class="bare">openwebbeans.apache.org/meecrowave/meecrowave-core/cli.html</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_generate_inputs_or_outputs">1.5. Generate inputs or outputs</h3>
<div class="paragraph">
<p>The Mojo <code>generate</code> (maven plugin goal) of the same plugin also embeds a generator you can use to bootstrap any input or output component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${talend-component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>generate-input<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>generate-sources<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>generate<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;type&gt;</span>input<span style="color:#070;font-weight:bold">&lt;/type&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>generate-output<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>generate-sources<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>generate<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;type&gt;</span>output<span style="color:#070;font-weight:bold">&lt;/type&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Generates an input (partition mapper + emitter)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Generates an output</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is intended to be used from the command line (or IDE Maven integration):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">$ mvn talend-component:generate \
    -Dtalend.generator.type=[input|output] \ <i class="conum" data-value="1"></i><b>(1)</b>
    [-Dtalend.generator.classbase=com.test.MyComponent] \ <i class="conum" data-value="2"></i><b>(2)</b>
    [-Dtalend.generator.family=my-family] \ <i class="conum" data-value="3"></i><b>(3)</b>
    [-Dtalend.generator.pom.read-only=false] <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>select the type of component you want, <code>input</code> to generate a mapper and emitter and <code>output</code> to generate an output processor</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>set the class name base (will be suffixed by the component type), if not set the package will be guessed and classname based on the basedir name</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>set the component family to use, default to the base dir name removing (component[s] from the name, ex: <code>my-component</code> will lead to <code>my</code> as family if not explicitly set)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>should the generator try to add <code>component-api</code> in the pom if not already here, if you added it you can set it to <code>false</code> directly in the pom</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For this command to work you will need to just register the plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${talend-component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gradle_plugin">2. Gradle Plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>gradle-talend-component</code> intends to help you to write components
validating components match best practices. It is inspired from the Maven plugin
and adds the ability to generate automatically the <code>dependencies.txt</code> file the SDK
uses to build the component classpath. For more information on the configuration
you can check out the maven properties matching the attributes.</p>
</div>
<div class="paragraph">
<p>Here is how to use it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
  repositories {
    mavenLocal()
    mavenCentral()
  }
  dependencies {
    classpath <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component:gradle-talend-component:</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>talendComponentVersion<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
  }
}

apply <span style="color:#606">plugin</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.talend.sdk.component</span><span style="color:#710">'</span></span>
apply <span style="color:#606">plugin</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">java</span><span style="color:#710">'</span></span>

<span style="color:#777">// optional customization</span>
talendComponentKit {
    <span style="color:#777">// dependencies.txt generation, replaces maven-dependency-plugin</span>
    dependenciesLocation = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">TALEND-INF/dependencies.txt</span><span style="color:#710">&quot;</span></span>
    <span style="color:#339;font-weight:bold">boolean</span> skipDependenciesFile = <span style="color:#069">false</span>;

    <span style="color:#777">// classpath for validation utilities</span>
    sdkVersion = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>talendComponentVersion<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
    apiVersion = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>talendComponentApiVersion<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>

    <span style="color:#777">// documentation</span>
    skipDocumentation = <span style="color:#069">false</span>
    documentationOutput = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(....)
    documentationLevel = <span style="color:#00D">2</span> <span style="color:#777">// first level will be == in the generated adoc</span>
    documentationTitle = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">My Component Family</span><span style="color:#710">'</span></span> <span style="color:#777">// default to project name</span>
    documentationFormats = [:] <span style="color:#777">// adoc attributes</span>
    documentationFormats = [:] <span style="color:#777">// renderings to do</span>

    <span style="color:#777">// validation</span>
    skipValidation = <span style="color:#069">false</span>
    validateFamily = <span style="color:#069">true</span>
    validateSerializable = <span style="color:#069">true</span>
    validateInternationalization = <span style="color:#069">true</span>
    validateModel = <span style="color:#069">true</span>
    validateMetadata = <span style="color:#069">true</span>
    validateComponent = <span style="color:#069">true</span>
    validateDataStore = <span style="color:#069">true</span>
    validateDataSet = <span style="color:#069">true</span>
    validateActions = <span style="color:#069">true</span>

    <span style="color:#777">// web</span>
    serverArguments = <span style="color:#339;font-weight:bold">[]</span>
    serverPort = <span style="color:#00D">8080</span>
}</code></pre>
</div>
</div>
</div>
</div>
<h1 id="_services" class="sect0">Services</h1>
<div class="sect1">
<h2 id="_internationalization_2">1. Internationalization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Recommanded practise for internationalization are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>store messages using <code>ResourceBundle</code> properties file in your component module</p>
</li>
<li>
<p>the location of the properties are in the same package than the related component(s) and is named <code>Messages</code> (ex: <code>org.talend.demo.MyComponent</code> will use <code>org.talend.demo.Messages[locale].properties</code>)</p>
</li>
<li>
<p>for your own messages use the internationalization API</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_internationalization_api">1.1. Internationalization API</h3>
<div class="paragraph">
<p>Overal idea is to design its messages as methods returning <code>String</code> values
and back the template by a <code>ResourceBundle</code> located in the same package than the interface
defining these methods and named <code>Messages</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
this is the mecanism to use to internationalize your own messages in your own components.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To ensure you internationalization API is identified you need to mark it with <code>@Internationalized</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Internationalized</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">interface</span> <span style="color:#B06;font-weight:bold">Translator</span> {

    <span style="color:#0a8;font-weight:bold">String</span> message();

    <span style="color:#0a8;font-weight:bold">String</span> templatizedMessage(<span style="color:#0a8;font-weight:bold">String</span> arg0, <span style="color:#339;font-weight:bold">int</span> arg1); <i class="conum" data-value="2"></i><b>(2)</b>

    <span style="color:#0a8;font-weight:bold">String</span> localized(<span style="color:#0a8;font-weight:bold">String</span> arg0, <span style="color:#007">@Language</span> <span style="color:#0a8;font-weight:bold">Locale</span> locale); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@Internationalized</code> allows to mark a class as a i18n service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>you can pass parameters and the message will use <code>MessageFormat</code> syntax to be resolved based on the <code>ResourceBundle</code> template</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>you can use <code>@Language</code> on a <code>Locale</code> parameter to specify manually the locale to use, note that a single value will be used (the first parameter tagged as such).</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_providing_some_actions_for_consumers_clients">2. Providing some actions for consumers/clients</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some cases you will desire to add some actions unrelated to the runtime. A simple example
is to enable clients - the users of the plugin/library - to test if a connection works. Even more concretely: <em>does my database is up?</em>.</p>
</div>
<div class="paragraph">
<p>To do so you need to define an <code>@Action</code> which is a method with a name (representing the event name) in a class decorated with <code>@Service</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Service</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyDbTester</span> {
    <span style="color:#007">@Action</span>(family = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">mycomp</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">test</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">public</span> Status doTest(<span style="color:#088;font-weight:bold">final</span> IncomingData data) {
        <span style="color:#080;font-weight:bold">return</span> ...;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
services are singleton so if you need some thread safety ensure they match that requirement. They
shouldn&#8217;t store any state too (state is held by the component) since they can be serialized any time.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
services are usable in components as well (matched by type) and allow to reuse some shared logic like a client. Here is a sample
with a service used to access files:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Emitter</span>(family = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">reader</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PersonReader</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Serializable</span> {
    <span style="color:#777">// attributes skipped to be concise</span>

    <span style="color:#088;font-weight:bold">public</span> PersonReader(<span style="color:#007">@Option</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file</span><span style="color:#710">&quot;</span></span>) <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">File</span> file,
                        <span style="color:#088;font-weight:bold">final</span> FileService service) {
        <span style="color:#950">this</span>.file = file;
        <span style="color:#950">this</span>.service = service;
    }

    <span style="color:#777">// use the service</span>
    <span style="color:#007">@PostConstruct</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> open() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">FileNotFoundException</span> {
        reader = service.createInput(file);
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
service is passed to constructor automatically, it can be used as a bean. Only call of service&#8217;s method is required.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_particular_action_types">2.1. Particular action types</h3>
<div class="paragraph">
<p>Some actions are that common and need a clear contract so they are defined as API first citizen, this is the case for wizards or healthchecks
for instance. Here is the list of all actions:</p>
</div>
<table class="tableblock frame-all grid-all table-striped table-hover table-ordered">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Return type</th>
<th class="tableblock halign-left valign-top">Sample returned type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.service.completion.DynamicValues</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dynamic_values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a method as being useful to fill potential values of a string option for a property denoted by its value. You can link a field as being completable using @Proposable(value). The resolution of the completion action is then done through the component family and value of the action. The callback doesn&#8217;t take any parameter.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{"items":[{"id":"value","label":"label"}]}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.service.healthcheck.HealthCheck</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">healthcheck</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This class marks an action doing a connection test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HealthCheckStatus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{"comment":"Something went wrong","status":"KO"}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.service.schema.DiscoverSchema</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">schema</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark an action as returning a discovered schema. Its parameter MUST be the type decorated with <code>@Discoverable</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Schema</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{"entries":[{"name":"column1","type":"STRING"}]}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.service.Action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.service.asyncvalidation.AsyncValidation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">validation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a method as being used to validate a configuration. IMPORTANT: this is a server validation so only use it if you can&#8217;t use other client side validation to implement it.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ValidationResult</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{"comment":"Something went wrong","status":"KO"}</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_built_in_services">3. Built in services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The framework provides some built-in services you can inject by type in components and actions out of the box.</p>
</div>
<div class="paragraph">
<p>Here is the list:</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>org.talend.sdk.component.api.service.cache.LocalCache</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides a small abstraction to cache data which don&#8217;t need to be recomputed very often. Commonly used by actions for the UI interactions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>org.talend.sdk.component.api.service.dependency.Resolver</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Allows to resolve a dependency from its Maven coordinates.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>javax.json.spi.JsonProvider</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>A JSON-P instance. Prefer other JSON-P instances if you don&#8217;t exactly know why you use this one.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>javax.json.JsonBuilderFactory</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>A JSON-P instance. It is recommanded to use this one instead of a custom one for memory/speed optimizations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>javax.json.JsonWriterFactory</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>A JSON-P instance. It is recommanded to use this one instead of a custom one for memory/speed optimizations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>javax.json.JsonReaderFactory</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>A JSON-P instance. It is recommanded to use this one instead of a custom one for memory/speed optimizations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>javax.json.stream.JsonParserFactory</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>A JSON-P instance. It is recommanded to use this one instead of a custom one for memory/speed optimizations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>javax.json.stream.JsonGeneratorFactory</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>A JSON-P instance. It is recommanded to use this one instead of a custom one for memory/speed optimizations.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
it assumes the dependency is locally available to the execution instance which is not guaranteed yet by the framework.
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>org.talend.sdk.component.api.service.configuration.LocalConfiguration</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Represents the local configuration which can be used during the design.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
it is not recommanded to use it for the runtime since the local configuration is generally different and the instances are distincts.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
you can also use the local cache as an interceptor with <code>@Cached</code>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Every interface that extends <code>HttpClient</code> and that contains methods annotated with <code>@Request</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>This let you define an http client in a declarative manner using an annotated interface.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See the <a href="#_httpclient_usage">HttpClient usage</a> for details.
</td>
</tr>
</table>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_httpclient_usage">3.1. HttpClient usage</h3>
<div class="paragraph">
<p>Let assume that we have a REST API defined like below, and that it requires a basic authentication header.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET     <code>/api/records/{id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST    <code>/api/records</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">with a json playload to be created <code>{"id":"some id", "data":"some data"}</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To create an http client able to consume this REST API, we will define an interface that extends <code>HttpClient</code>,</p>
</div>
<div class="paragraph">
<p>The <code>HttpClient</code> interface lets you set the <code>base</code> for the http address that our client will hit.</p>
</div>
<div class="paragraph">
<p>The <code>base</code> is the part of the address that we will need to add to the request path to hit the api.</p>
</div>
<div class="paragraph">
<p>Every method annotated with <code>@Request</code> of our interface will define an http request.
Also every request can have <code>@Codec</code> that let us encode/decode the request/response playloads.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
if your payload(s) is(are) <code>String</code> or <code>Void</code> you can ignore the coder/decoder.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">interface</span> <span style="color:#B06;font-weight:bold">APIClient</span> <span style="color:#088;font-weight:bold">extends</span> HttpClient {
    <span style="color:#007">@Request</span>(path = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">api/records/{id}</span><span style="color:#710">&quot;</span></span>, method = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">GET</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#007">@Codec</span>(decoder = RecordDecoder.class) <span style="color:#777">//decoder =  decode returned data to Record class</span>
    Record getRecord(<span style="color:#007">@Header</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Authorization</span><span style="color:#710">&quot;</span></span>) <span style="color:#0a8;font-weight:bold">String</span> basicAuth, <span style="color:#007">@Path</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id</span><span style="color:#710">&quot;</span></span>) <span style="color:#339;font-weight:bold">int</span> id);

    <span style="color:#007">@Request</span>(path = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">api/records</span><span style="color:#710">&quot;</span></span>, method = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">POST</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#007">@Codec</span>(encoder = RecordEncoder.class, decoder = RecordDecoder.class) <span style="color:#777">//encoder = encode record to fit request format (json in this example)</span>
    Record createRecord(<span style="color:#007">@Header</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Authorization</span><span style="color:#710">&quot;</span></span>) <span style="color:#0a8;font-weight:bold">String</span> basicAuth, Record record);
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The interface should extends <code>HttpClient</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the codec classes (class that implement Encoder/Decoder) you can inject any of your services annotated with <code>@Service</code> or <code>@Internationalized</code> into the constructor.
The i18n services can be useful to have i18n messages for errors handling for example.</p>
</div>
<div class="paragraph">
<p>This interface can be injected into our Components classes or Services to consume the defined api.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Service</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyService</span> {

    <span style="color:#088;font-weight:bold">private</span> APIClient client;

    <span style="color:#088;font-weight:bold">public</span> MyService(...,APIClient client){
        <span style="color:#777">//...</span>
        <span style="color:#950">this</span>.client = client;
        client.base(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://localhost:8080</span><span style="color:#710">&quot;</span></span>);<span style="color:#777">// init the base of the api, ofen in a PostConstruct or init method</span>
    }

    <span style="color:#777">//...</span>
    <span style="color:#777">// Our get request</span>
    Record rec =  client.getRecord(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Basic MLFKG?VKFJ</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">100</span>);

    <span style="color:#777">//...</span>
    <span style="color:#777">// Our post request</span>
    Record newRecord = client.createRecord(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Basic MLFKG?VKFJ</span><span style="color:#710">&quot;</span></span>, <span style="color:#080;font-weight:bold">new</span> Record());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: by default <code><strong>/</strong>+json</code> are mapped to JSON-P and <code><strong>/</strong>+xml</code> to JAX-B if the model has a <code>@XmlRootElement</code> annotation.</p>
</div>
<div class="sect3">
<h4 id="_advanced_http_client_request_customization">3.1.1. Advanced HTTP client request customization</h4>
<div class="paragraph">
<p>For advanced cases you can customize the <code>Connection</code> directly using <code>@UseConfigurer</code> on the method.
It will call your custom instance of <code>Configurer</code>. Note that you can use some <code>@ConfigurerOption</code> in the method
signature to pass some configurer configuration.</p>
</div>
<div class="paragraph">
<p>For instance if you have this configurer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">BasicConfigurer</span> <span style="color:#088;font-weight:bold">implements</span> Configurer {
    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> configure(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Connection</span> connection, <span style="color:#088;font-weight:bold">final</span> ConfigurerConfiguration configuration) {
        <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span> user = configuration.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">username</span><span style="color:#710">&quot;</span></span>, <span style="color:#0a8;font-weight:bold">String</span>.class);
        <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span> pwd = configuration.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">password</span><span style="color:#710">&quot;</span></span>, <span style="color:#0a8;font-weight:bold">String</span>.class);
        connection.withHeader(
            <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Authorization</span><span style="color:#710">&quot;</span></span>,
            Base64.getEncoder().encodeToString((user + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">:</span><span style="color:#710">'</span></span> + pwd).getBytes(StandardCharsets.UTF_8)));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then set it on a method to automatically add the basic header with this kind of API usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">interface</span> <span style="color:#B06;font-weight:bold">APIClient</span> <span style="color:#088;font-weight:bold">extends</span> HttpClient {
    <span style="color:#007">@Request</span>(path = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">...</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#007">@UseConfigurer</span>(BasicConfigurer.class)
    Record findRecord(<span style="color:#007">@ConfigurerOption</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">username</span><span style="color:#710">&quot;</span></span>) <span style="color:#0a8;font-weight:bold">String</span> user, <span style="color:#007">@ConfigurerOption</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">password</span><span style="color:#710">&quot;</span></span>) <span style="color:#0a8;font-weight:bold">String</span> pwd);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_services_and_interceptors">4. Services and interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For common concerns like caching, auditing etc, it can be fancy to use interceptor like API. It is enabled by the framework
on services.</p>
</div>
<div class="paragraph">
<p>An interceptor defines an annotation marked with <code>@Intercepts</code> which defines the implementation of the interceptor (an <code>InterceptorHandler</code>).</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Intercepts</span>(LoggingHandler.class)
<span style="color:#007">@Target</span>({ TYPE, METHOD })
<span style="color:#007">@Retention</span>(RUNTIME)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#007">@interface</span> Logged {
    <span style="color:#0a8;font-weight:bold">String</span> value();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then handler is created from its constructor and can take service injections (by type). The first parameter, however, can be
a <code>BiFunction&lt;Method, Object[], Object&gt;</code> which representes the invocation chain if your interceptor can be used with others.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
if you do a generic interceptor it is important to pass the invoker as first parameter. If you don&#8217;t do so
you can&#8217;t combine interceptors at all.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is an interceptor implementation for our <code>@Logged</code> API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">LoggingHandler</span> <span style="color:#088;font-weight:bold">implements</span> InterceptorHandler {
    <span style="color:#777">// injected</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> BiFunction&lt;<span style="color:#0a8;font-weight:bold">Method</span>, <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>, <span style="color:#0a8;font-weight:bold">Object</span>&gt; invoker;
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> SomeService service;

    <span style="color:#777">// internal</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">ConcurrentMap</span>&lt;<span style="color:#0a8;font-weight:bold">Method</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; loggerNames = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">ConcurrentHashMap</span>&lt;&gt;();

    <span style="color:#088;font-weight:bold">public</span> CacheHandler(<span style="color:#088;font-weight:bold">final</span> BiFunction&lt;<span style="color:#0a8;font-weight:bold">Method</span>, <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>, <span style="color:#0a8;font-weight:bold">Object</span>&gt; invoker, <span style="color:#088;font-weight:bold">final</span> SomeService service) {
        <span style="color:#950">this</span>.invoker = invoker;
        <span style="color:#950">this</span>.service = service;
    }

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Object</span> invoke(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Method</span> method, <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> args) {
        <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span> name = loggerNames.computeIfAbsent(method, m -&gt; findAnnotation(m, Logged.class).get().value());
        service.getLogger(name).info(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Invoking {}</span><span style="color:#710">&quot;</span></span>, method.getName());
        <span style="color:#080;font-weight:bold">return</span> invoker.apply(method, args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This implementation is compatible with interceptor chains since it takes the invoker as first constructor parameter
and it also takes a service injection. Then the implementation just does what is needed - logging the invoked method here.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the <code>findAnnotation</code> annotation - inherited from <code>InterceptorHandler</code> is an utility method to find an annotation on a method
or class (in this order).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_an_execution_chain_or_pipeline">5. Creating an execution chain or pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two kind of chains the framework supports:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>standalone chains</p>
</li>
<li>
<p><a href="https://beam.apache.org/">Beam</a> chains</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_standalone_chains">5.1. Standalone chains</h3>
<div class="paragraph">
<p>For now the standalone chains only support linear flows (more to come) and are built based on a <code>ExecutionChainBuilder</code>.</p>
</div>
<div class="paragraph">
<p>This one will take some metadata about the flow (which input with which configuration, which processors, which processor order and configuration&#8230;&#8203;)
and will execute it linearly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExecutionChainBuilder.start()
        .withConfiguration(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">SampleJob</span><span style="color:#710">&quot;</span></span>, <span style="color:#069">true</span>) <i class="conum" data-value="1"></i><b>(1)</b>
        .withInput(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">reader</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashMap</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt;() {{ <i class="conum" data-value="2"></i><b>(2)</b>
            put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/tmp/input.csv</span><span style="color:#710">&quot;</span></span>);
        }})
        .toProcessor(<span style="color:#069">null</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">mapper</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">2</span>, emptyMap()) <i class="conum" data-value="2"></i><b>(2)</b>
        .toProcessor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">reject</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">writer</span><span style="color:#710">&quot;</span></span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashMap</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt;() {{ <i class="conum" data-value="2"></i><b>(2)</b>
            put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/tmp/output.csv</span><span style="color:#710">&quot;</span></span>);
        }}).getParent()
        .toProcessor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">reject</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">writer</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashMap</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt;() {{ <i class="conum" data-value="2"></i><b>(2)</b>
            put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/tmp/output.csv</span><span style="color:#710">&quot;</span></span>);
        }})
        .create(manager, plugin -&gt; <span style="color:#069">null</span>, <span style="color:#080;font-weight:bold">new</span> CountingSuccessListener(), <span style="color:#080;font-weight:bold">new</span> ToleratingErrorHandler(<span style="color:#00D">0</span>)) <i class="conum" data-value="3"></i><b>(3)</b>
        .get()
        .execute(); <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can configure some global execution configuration, like giving it a name and if system properties can override the component configuration
using <code>&lt;component group name&gt;.&lt;component name&gt;.&lt;configuration property name&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Each component is registered from its component name (what is passed in <code>family</code> of the component annotation),
its own name (<code>name</code> method of the annotation) and its configuration as a map (2).</p>
</div>
<div class="paragraph">
<p>Once the flow is defined (there is no more processor after), then you can create the <code>ExecutionChain</code> (3) with its success/error listeners
to handle it in a custom manner and finally you can get it and execute the flow/pipeline (4).</p>
</div>
<div class="paragraph">
<p>A chain needs a <code>ComponentManager</code> which is the manager of the plugins. The easiest is to use its default constructor to create one instance.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
this manager needs to be closed when no more needed so don&#8217;t forget to call close.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is a sample code for the previous chain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Main</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args) {
        <span style="color:#088;font-weight:bold">final</span> ComponentManager manager = ComponentManager.instance()
        ExecutionChainBuilder.start()
                .withConfiguration(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">SampleJob</span><span style="color:#710">&quot;</span></span>, <span style="color:#069">true</span>)
                .fromInput(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">reader</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashMap</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt;() {{
                    put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/tmp/input.csv</span><span style="color:#710">&quot;</span></span>);
                }})
                .toProcessor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">rejected</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">mapper</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>, emptyMap())
                .getParent()
                .toProcessor(Branches.DEFAULT_BRANCH, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">mapper</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>, emptyMap())
                .toProcessor(Branches.DEFAULT_BRANCH, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">writer</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">3</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashMap</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt;() {{
                    put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/tmp/output.csv</span><span style="color:#710">&quot;</span></span>);
                }})
                .create(manager, plugin -&gt; <span style="color:#069">null</span>, <span style="color:#080;font-weight:bold">new</span> CountingSuccessListener(), <span style="color:#080;font-weight:bold">new</span> ToleratingErrorHandler(<span style="color:#00D">0</span>))
                .get()
                .execute();
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
this API is not very powerful but allows to test simple cases, you can have a look to beam direct runner and the Talend Component beam bridge
for more advanced cases.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
the number before the configuration (map) is the version of this configuration, it allows to automatically migrate
from a version to the currently available one when needed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_beam_case">5.2. Beam case</h3>
<div class="paragraph">
<p>For beam case, you need to rely on beam pipeline definition and use <code>component-runtime-beam</code> dependency which provides Beam bridges.</p>
</div>
<div class="sect3">
<h4 id="_i_o">5.2.1. I/O</h4>
<div class="paragraph">
<p><code>org.talend.sdk.component.runtime.beam.TalendIO</code> provides a way to convert a partition mapper or a processor to an input or processor
using the <code>read</code> or <code>write</code> methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Main</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args) {
        <span style="color:#088;font-weight:bold">final</span> ComponentManager manager = ComponentManager.instance()
        Pipeline pipeline = Pipeline.create();
        <span style="color:#777">//Create beam input from mapper and apply input to pipeline</span>
        pipeline.apply(TalendIO.read(manager.findMapper(manager.findMapper(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">reader</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashMap</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt;() {{
                    put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">fileprefix</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">input</span><span style="color:#710">&quot;</span></span>);
                }}).get()))
                .apply(<span style="color:#080;font-weight:bold">new</span> ViewsMappingTransform(emptyMap(), <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>)) <span style="color:#777">// prepare it for the output record format (see next part)</span>
        <span style="color:#777">//Create beam processor from talend processor and apply to pipeline</span>
                .apply(TalendIO.write(manager.findProcessor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">test</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">writer</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashMap</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt;() {{
                    put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">fileprefix</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">output</span><span style="color:#710">&quot;</span></span>);
                }}).get(), emptyMap()));

        <span style="color:#777">//... run pipeline</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_processors">5.2.2. Processors</h4>
<div class="paragraph">
<p><code>org.talend.sdk.component.runtime.beam.TalendFn</code> provides the way to wrap a processor in a Beam <code>PTransform</code> and integrate it in the pipeline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Main</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args) {
        <span style="color:#777">//Component manager and pipeline initialization...</span>

        <span style="color:#777">//Create beam PTransform from processor and apply input to pipeline</span>
        pipeline.apply(TalendFn.asFn(manager.findProcessor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">mapper</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>, emptyMap())).get())), emptyMap());

        <span style="color:#777">//... run pipeline</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The multiple inputs/outputs are represented by a <code>Map</code> element in beam case to avoid to use multiple inputs/outputs.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
you can use <code>ViewsMappingTransform</code> or <code>CoGroupByKeyResultMappingTransform</code> to adapt the input/output
format to the record format representing the multiple inputs/output, so a kind of <code>Map&lt;String, List&lt;?&gt;&gt;</code>,
but materialized as a <code>JsonObject</code>. Input data must be of type <code>JsonObject</code> in this case.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_deployment">5.2.3. Deployment</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Beam serializing components it is crucial to add <code>component-runtime-standalone</code> dependency to the project. It will take
care of providing an implicit and lazy <code>ComponentManager</code> managing the component in a fatjar case.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_convert_a_beam_io_in_a_component_i_o">5.2.4. Convert a Beam.io in a component I/O</h4>
<div class="paragraph">
<p>For simple I/O you can get automatic conversion of the Beam.io to a component I/O transparently if you decorated your <code>PTransform</code>
with <code>@PartitionMapper</code> or <code>@Processor</code>.</p>
</div>
<div class="paragraph">
<p>The limitation are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Inputs must implement <code>PTransform&lt;PBegin, PCollection&lt;?&gt;&gt;</code> and must be a <code>BoundedSource</code>.</p>
</li>
<li>
<p>Outputs must implement <code>PTransform&lt;PCollection&lt;?&gt;, PDone&gt;</code> and just register on the input <code>PCollection</code> a <code>DoFn</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More information on that topic on <a href="wrapping-a-beam-io.html">How to wrap a Beam I/O</a> page.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_define_a_custom_api">6. Advanced: define a custom API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to extend the Component API for custom front features.</p>
</div>
<div class="paragraph">
<p>What is important here is to keep in mind you should do it
only if it targets not portable components (only used by the Studio or Beam).</p>
</div>
<div class="paragraph">
<p>In term of organization it is recommanded to create a custom <code>xxxx-component-api</code> module with the new set of annotations.</p>
</div>
<div class="sect2">
<h3 id="_extending_the_ui">6.1. Extending the UI</h3>
<div class="paragraph">
<p>To extend the UI just add an annotation which can be put on <code>@Option</code> fields which is decorated with <code>@Ui</code>.
All its members will be put in the metadata of the parameter. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Ui</span>
<span style="color:#007">@Target</span>(TYPE)
<span style="color:#007">@Retention</span>(RUNTIME)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#007">@interface</span> MyLayout {
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="_talend_component_testing_documentation" class="sect0">Talend Component Testing Documentation</h1>
<div class="sect1">
<h2 id="documentation-testing-start">1. Best practises</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
this part is mainly around tools usable with JUnit. You can use most of these techniques with TestNG
as well, check out the documentation if you need to use TestNG.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_parameterized_tests">1.1. Parameterized tests</h3>
<div class="paragraph">
<p>This is a great solution to repeat the same test multiple times. Overall idea
is to define a test scenario (<code>I test function F</code>) and to make the input/output data
dynamic.</p>
</div>
<div class="sect3">
<h4 id="_junit_4">1.1.1. JUnit 4</h4>
<div class="paragraph">
<p>Here is an example. Let&#8217;s assume we have this test which validates the connection URI using <code>ConnectionService</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyConnectionURITest</span> {
    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> checkMySQL() {
        assertTrue(<span style="color:#080;font-weight:bold">new</span> ConnectionService().isValid(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jdbc:mysql://localhost:3306/mysql</span><span style="color:#710">&quot;</span></span>));
    }

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> checkOracle() {
        assertTrue(<span style="color:#080;font-weight:bold">new</span> ConnectionService().isValid(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jdbc:oracle:thin:@//myhost:1521/oracle</span><span style="color:#710">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We clearly identify the test method is always the same except the value. It can therefore be rewritter
using JUnit <code>Parameterized</code> runner like that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@RunWith</span>(Parameterized.class) <i class="conum" data-value="1"></i><b>(1)</b>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyConnectionURITest</span> {

    <span style="color:#007">@Parameterized</span>.Parameters(name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">{0}</span><span style="color:#710">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#0a8;font-weight:bold">Iterable</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; uris() { <i class="conum" data-value="3"></i><b>(3)</b>
        <span style="color:#080;font-weight:bold">return</span> asList(
            <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jdbc:mysql://localhost:3306/mysql</span><span style="color:#710">&quot;</span></span>,
            <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jdbc:oracle:thin:@//myhost:1521/oracle</span><span style="color:#710">&quot;</span></span>);
    }

    <span style="color:#007">@Parameterized</span>.Parameter <i class="conum" data-value="4"></i><b>(4)</b>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> uri;

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> isValid() { <i class="conum" data-value="5"></i><b>(5)</b>
        assertNotNull(uri);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Parameterized</code> is the runner understanding <code>@Parameters</code> and how to use it. Note that you can generate random data here if desired.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>by default the name of the executed test is the index of the data, here we customize it using the first parameter <code>toString()</code> value to have something more readable</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the <code>@Parameters</code> method <code>MUST</code> be static and return an array or iterable of the data used by the tests</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>you can then inject the current data using <code>@Parameter</code> annotation, it can take a parameter if you use an array of array instead of an iterable of object in <code>@Parameterized</code> and you can select which item you want injected this way</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the <code>@Test</code> method will be executed using the contextual data, in this sample we&#8217;ll get executed twice with the 2 specified urls</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
you don&#8217;t have to define a single <code>@Test</code> method, if you define multiple, each of them will be executed with all the data (ie if we add a test in previous example you will get 4 tests execution - 2 per data, ie 2x2)
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_junit_5">1.1.2. JUnit 5</h4>
<div class="paragraph">
<p>JUnit 5 reworked this feature to make it way easier to use. The full documentation is available at <a href="http://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests" class="bare">junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests</a>.</p>
</div>
<div class="paragraph">
<p>The main difference is you can also define inline on the test method that it is a parameterized test and which are the values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ParameterizedTest</span>
<span style="color:#007">@ValueSource</span>(strings = { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">racecar</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">radar</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">able was I ere I saw elba</span><span style="color:#710">&quot;</span></span> })
<span style="color:#339;font-weight:bold">void</span> mytest(<span style="color:#0a8;font-weight:bold">String</span> currentValue) {
    <span style="color:#777">// do test</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However you can still use the previous behavior using a method binding configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ParameterizedTest</span>
<span style="color:#007">@MethodSource</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">stringProvider</span><span style="color:#710">&quot;</span></span>)
<span style="color:#339;font-weight:bold">void</span> mytest(<span style="color:#0a8;font-weight:bold">String</span> currentValue) {
    <span style="color:#777">// do test</span>
}

<span style="color:#088;font-weight:bold">static</span> Stream&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; stringProvider() {
    <span style="color:#080;font-weight:bold">return</span> Stream.of(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">foo</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bar</span><span style="color:#710">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This last option allows you to inject any type of value - not only primitives - which is very common to define scenarii.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
don&#8217;t forget to add <code>junit-jupiter-params</code> dependency to benefit from this feature.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_component_runtime_testing">2. component-runtime-testing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_component_runtime_junit">2.1. component-runtime-junit</h3>
<div class="paragraph">
<p><code>component-runtime-junit</code> is a small test library allowing you to validate simple logic based on Talend Component tooling.</p>
</div>
<div class="paragraph">
<p>To import it add to your project the following dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>component-runtime-junit<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${talend-component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;scope&gt;</span>test<span style="color:#070;font-weight:bold">&lt;/scope&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_junit_4_2">2.1.1. JUnit 4</h4>
<div class="paragraph">
<p>Then you can define a standard JUnit test and use the <code>SimpleComponentRule</code> rule:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyComponentTest</span> {

    <span style="color:#007">@Rule</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">final</span> SimpleComponentRule components = <span style="color:#080;font-weight:bold">new</span> SimpleComponentRule(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component.mycomponent.</span><span style="color:#710">&quot;</span></span>);

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> produce() {
        ExecutionChainBuilder.start() <i class="conum" data-value="2"></i><b>(2)</b>
                .fromInput(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">yourcomponentfamily</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">yourcomponent</span><span style="color:#710">&quot;</span></span>, createComponentConfig())
                .toProcessor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">test</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">collector</span><span style="color:#710">&quot;</span></span>, emptyMap())
                .create(components.asManager(), p -&gt; <span style="color:#069">null</span>, Assert::assertNotNull, (data, exception) -&gt; {
                    fail(exception.getMessage());
                    <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">null</span>;
                }).get().execute();

        <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;MyRecord&gt; records = components.getCollectedData(MyRecord.class); <i class="conum" data-value="3"></i><b>(3)</b>
        doAssertRecords(records); <span style="color:#777">// depending your test</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the rule will create a component manager and provide two mock components: an emitter and a collector. Don&#8217;t forget to set the root package of your component to enable it.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>you define any chain you want to test, it generally uses the mock as source or collector</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>you validate your component behavior, for a source you can assert the right records were emitted in the mock collect</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_junit_5_2">2.1.2. JUnit 5</h4>
<div class="paragraph">
<p>The JUnit 5 integration is mainly the same as for JUnit 4 except it uses the new JUnit 5 extension mecanism.</p>
</div>
<div class="paragraph">
<p>The entry point is the <code>@WithComponents</code> annotation you put on your test class which takes the
component package you want to test and you can use <code>@Injected</code> to inject in a test class field an instance of <code>ComponentsHandler</code>
which exposes the same utilities than the JUnit 4 rule:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@WithComponents</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component.junit.component</span><span style="color:#710">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">ComponentExtensionTest</span> {
    <span style="color:#007">@Injected</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span style="color:#088;font-weight:bold">private</span> ComponentsHandler handler;

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> manualMapper() {
        <span style="color:#088;font-weight:bold">final</span> Mapper mapper = handler.createMapper(<span style="color:#0a8;font-weight:bold">Source</span>.class, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Source</span>.Config() {

            {
                values = asList(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">b</span><span style="color:#710">&quot;</span></span>);
            }
        });
        assertFalse(mapper.isStream());
        <span style="color:#088;font-weight:bold">final</span> Input input = mapper.create();
        assertEquals(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a</span><span style="color:#710">&quot;</span></span>, input.next());
        assertEquals(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">b</span><span style="color:#710">&quot;</span></span>, input.next());
        assertNull(input.next());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The annotation defines which components to register in the test context.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The field allows to get the handler to be able to orchestrate the tests.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if it is the first time you use JUnit 5, don&#8217;t forget the imports changed and you must use <code>org.junit.jupiter.api.Test</code> instead of <code>org.junit.Test</code>.
Some IDE versions and <code>surefire</code> versions can also need you to install either a plugin or a specific configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_mocking_the_output">2.1.3. Mocking the output</h4>
<div class="paragraph">
<p>Using the component "test"/"collector" as in previous sample stores all records emitted by the chain (typically your source)
in memory, you can then access them using <code>theSimpleComponentRule.getCollectoedRecord(type)</code>. Note that this method filters by type,
if you don&#8217;t care of the type just use <code>Object.class</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mocking_the_input">2.1.4. Mocking the input</h4>
<div class="paragraph">
<p>The input mocking is symmetric to the output but here you provide the data you want to inject:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyComponentTest</span> {

    <span style="color:#007">@Rule</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">final</span> SimpleComponentRule components = <span style="color:#080;font-weight:bold">new</span> SimpleComponentRule(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component.mycomponent.</span><span style="color:#710">&quot;</span></span>);

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> produce() {
        components.setInputData(asList(createData(), createData(), createData())); <i class="conum" data-value="1"></i><b>(1)</b>

        ExecutionChainBuilder.start() <i class="conum" data-value="2"></i><b>(2)</b>
                .fromInput(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">test</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">emitter</span><span style="color:#710">&quot;</span></span>, emptyMap())
                .toProcessor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">yourcomponentfamily</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">myoutput</span><span style="color:#710">&quot;</span></span>, createComponentConfig())
                .create(components.asManager(), p -&gt; <span style="color:#069">null</span>, Assert::assertNotNull, (data, exception) -&gt; {
                    fail(exception.getMessage());
                    <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">null</span>;
                }).get().execute();

        assertMyOutputProcessedTheInputData();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>using <code>setInputData</code> you prepare the execution(s) to have a fake input when using "test"/"emitter" component.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_creating_runtime_configuration_from_component_configuration">2.1.5. Creating runtime configuration from component configuration</h4>
<div class="paragraph">
<p>The component configuration is a POJO (using <code>@Option</code> on fields) and the runtime configuration (<code>ExecutionChainBuilder</code>) uses
a <code>Map&lt;String, String&gt;</code>. To make the conversion easier, the JUnit integration provides a <code>SimpleFactory.configurationByExample</code> utility
to get this map instance from a configuration instance.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">final</span> MyComponentConfig componentConfig = <span style="color:#080;font-weight:bold">new</span> MyComponentConfig();
componentConfig.setUser(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">....</span><span style="color:#710">&quot;</span></span>);
<span style="color:#777">// .. other inits</span>

<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; configuration = configurationByExample(componentConfig);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_a_mapper">2.1.6. Testing a Mapper</h4>
<div class="paragraph">
<p>The <code>SimpleComponentRule</code> also allows to test a mapper unitarly, you can get an instance from a configuration
and you can execute this instance to collect the output. Here is a snippet doing that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MapperTest</span> {

    <span style="color:#007">@ClassRule</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> SimpleComponentRule COMPONENT_FACTORY = <span style="color:#080;font-weight:bold">new</span> SimpleComponentRule(
            <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.company.talend.component</span><span style="color:#710">&quot;</span></span>);

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> mapper() {
        <span style="color:#088;font-weight:bold">final</span> Mapper mapper = COMPONENT_FACTORY.createMapper(MyMapper.class, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Source</span>.Config() {{
            values = asList(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">b</span><span style="color:#710">&quot;</span></span>);
        }});
        assertEquals(asList(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">b</span><span style="color:#710">&quot;</span></span>), COMPONENT_FACTORY.collectAsList(<span style="color:#0a8;font-weight:bold">String</span>.class, mapper));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_a_processor">2.1.7. Testing a Processor</h4>
<div class="paragraph">
<p>As for the mapper a processor is testable unitary. The case is a bit more complex since you can have multiple
inputs and outputs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">ProcessorTest</span> {

    <span style="color:#007">@ClassRule</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> SimpleComponentRule COMPONENT_FACTORY = <span style="color:#080;font-weight:bold">new</span> SimpleComponentRule(
            <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.company.talend.component</span><span style="color:#710">&quot;</span></span>);

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> processor() {
        <span style="color:#088;font-weight:bold">final</span> Processor processor = COMPONENT_FACTORY.createProcessor(Transform.class, <span style="color:#069">null</span>);
        <span style="color:#088;font-weight:bold">final</span> SimpleComponentRule.Outputs outputs = COMPONENT_FACTORY.collect(processor,
                        <span style="color:#080;font-weight:bold">new</span> JoinInputFactory().withInput(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">__default__</span><span style="color:#710">&quot;</span></span>, asList(<span style="color:#080;font-weight:bold">new</span> Transform.Record(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a</span><span style="color:#710">&quot;</span></span>), <span style="color:#080;font-weight:bold">new</span> Transform.Record(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bb</span><span style="color:#710">&quot;</span></span>)))
                                              .withInput(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">second</span><span style="color:#710">&quot;</span></span>, asList(<span style="color:#080;font-weight:bold">new</span> Transform.Record(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1</span><span style="color:#710">&quot;</span></span>), <span style="color:#080;font-weight:bold">new</span> Transform.Record(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">2</span><span style="color:#710">&quot;</span></span>)))
                );
        assertEquals(<span style="color:#00D">2</span>, outputs.size());
        assertEquals(asList(<span style="color:#00D">2</span>, <span style="color:#00D">3</span>), outputs.get(<span style="color:#0a8;font-weight:bold">Integer</span>.class, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">size</span><span style="color:#710">&quot;</span></span>));
        assertEquals(asList(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a1</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bb2</span><span style="color:#710">&quot;</span></span>), outputs.get(<span style="color:#0a8;font-weight:bold">String</span>.class, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">value</span><span style="color:#710">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here again the rule allows you to instantiate a <code>Processor</code> from your code
and then to <code>collect</code> the output from the inputs you pass in. There are two convenient implementation
of the input factory:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>MainInputFactory</code> for processors using only the default input.</p>
</li>
<li>
<p><code>JoinInputfactory</code> for processors using multiple inputs have a method <code>withInput(branch, data)</code> The first arg is the branch name
and the second arg is the data used by the branch.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
you can also implement your own input representation if needed implementing <code>org.talend.sdk.component.junit.ControllableInputFactory</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_component_runtime_testing_spark">2.2. component-runtime-testing-spark</h3>
<div class="paragraph">
<p>The folowing artifact will allow you to test against a spark cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>component-runtime-testing-spark<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${talend-component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;scope&gt;</span>test<span style="color:#070;font-weight:bold">&lt;/scope&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_junit_4_3">2.2.1. JUnit 4</h4>
<div class="paragraph">
<p>The usage relies on a JUnit <code>TestRule</code>. It is recommanded to use it as a <code>@ClassRule</code> to ensure
a single instance of a spark cluster is built but you can also use it as a simple <code>@Rule</code> which means
it will be created per method instead of per test class.</p>
</div>
<div class="paragraph">
<p>It takes as parameter the spark and scala version to use. It will then fork a master and N slaves.
Finally it will give you <code>submit*</code> method allowing you to send jobs either from the test classpath
or from a shade if you run it as an integration test.</p>
</div>
<div class="paragraph">
<p>Here is a sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SparkClusterRuleTest</span> {

    <span style="color:#007">@ClassRule</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> SparkClusterRule SPARK = <span style="color:#080;font-weight:bold">new</span> SparkClusterRule(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">2.10</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1.6.3</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>);

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> classpathSubmit() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">IOException</span> {
        SPARK.submitClasspath(SubmittableMain.class, getMainArgs());

        <span style="color:#777">// do wait the test passed</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
this is working with <code>@Parameterized</code> so you can submit a bunch of jobs with different args and even combine it with beam <code>TestPipeline</code> if you make it <code>transient</code>!
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_junit_5_3">2.2.2. JUnit 5</h4>
<div class="paragraph">
<p>The integration with JUnit 5 of that spark cluster logic uses <code>@WithSpark</code> marker for the extension
and let you, optionally, inject through <code>@SparkInject</code>, the <code>BaseSpark&lt;?&gt;</code> handler to access te spark cluster
meta information - like its host/port.</p>
</div>
<div class="paragraph">
<p>Here is a basic test using it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@WithSpark</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SparkExtensionTest</span> {

    <span style="color:#007">@SparkInject</span>
    <span style="color:#088;font-weight:bold">private</span> BaseSpark&lt;?&gt; spark;

    <span style="color:#007">@Test</span>
    <span style="color:#339;font-weight:bold">void</span> classpathSubmit() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">IOException</span> {
        <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">File</span> out = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(jarLocation(SparkClusterRuleTest.class).getParentFile(), <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">classpathSubmitJunit5.out</span><span style="color:#710">&quot;</span></span>);
        <span style="color:#080;font-weight:bold">if</span> (out.exists()) {
            out.delete();
        }
        spark.submitClasspath(SparkClusterRuleTest.SubmittableMain.class, spark.getSparkMaster(), out.getAbsolutePath());

        await().atMost(<span style="color:#00D">5</span>, MINUTES).until(
                () -&gt; out.exists() ? Files.readAllLines(out.toPath()).stream().collect(joining(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#b0b">\n</span><span style="color:#710">&quot;</span></span>)).trim() : <span style="color:#069">null</span>,
                equalTo(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">b -&gt; 1</span><span style="color:#b0b">\n</span><span style="color:#D20">a -&gt; 1</span><span style="color:#710">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_to_know_the_job_is_done">2.2.3. How to know the job is done</h4>
<div class="paragraph">
<p>In current state, <code>SparkClusterRule</code> doesn&#8217;t allow to know a job execution is done - even if it exposes the webui url so
you can poll it to check. The best at the moment is to ensure the output of your job exists and contains the right value.</p>
</div>
<div class="paragraph">
<p><code>awaitability</code> or equivalent library can help you to write such logic.</p>
</div>
<div class="paragraph">
<p>Here are the coordinates of the artifact:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.awaitility<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>awaitility<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>3.0.0<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;scope&gt;</span>test<span style="color:#070;font-weight:bold">&lt;/scope&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is how to wait a file exists and its content (for instance) is the expected one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">await()
    .atMost(<span style="color:#00D">5</span>, MINUTES)
    .until(
        () -&gt; out.exists() ? Files.readAllLines(out.toPath()).stream().collect(joining(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#b0b">\n</span><span style="color:#710">&quot;</span></span>)).trim() : <span style="color:#069">null</span>,
        equalTo(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">the expected content of the file</span><span style="color:#710">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_component_runtime_http_junit">2.3. component-runtime-http-junit</h3>
<div class="paragraph">
<p>The HTTP JUnit module allows you to mock REST API very easily. Here are its coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>component-runtime-junit<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${talend-component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;scope&gt;</span>test<span style="color:#070;font-weight:bold">&lt;/scope&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
this module uses Apache Johnzon and Netty, if you have any conflict (in particular with netty) you can add the classifier <code>shaded</code>
to the dependency and the two dependencies are shaded avoiding the conflicts with your component.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It supports JUnit 4 and JUnit 5 as well but the overall concept is the exact same one: the extension/rule
is able to serve precomputed responses saved in the classpath.</p>
</div>
<div class="paragraph">
<p>You can plug your own <code>ResponseLocator</code> to map a request to a response but the default implementation - which should be sufficient
in most cases - will look in <code>talend/testing/http/&lt;class name&gt;_&lt;method name&gt;.json</code>. Note that you can also put it
in <code>talend/testing/http/&lt;request path&gt;.json</code>.</p>
</div>
<div class="sect3">
<h4 id="_junit_4_4">2.3.1. JUnit 4</h4>
<div class="paragraph">
<p>JUnit 4 setup is done through two rules: <code>JUnit4HttpApi</code> which is responsible to start the server and <code>JUnit4HttpApiPerMethodConfigurator</code>
which is responsible to configure the server per test and also handle the capture mode (see later).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
if you don&#8217;t use the <code>JUnit4HttpApiPerMethodConfigurator</code>, the capture feature will be deactivated and the per test mocking will not be available.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Most of the test will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyRESTApiTest</span> {
    <span style="color:#007">@ClassRule</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> JUnit4HttpApi API = <span style="color:#080;font-weight:bold">new</span> JUnit4HttpApi();

    <span style="color:#007">@Rule</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">final</span> JUnit4HttpApiPerMethodConfigurator configurator = <span style="color:#080;font-weight:bold">new</span> JUnit4HttpApiPerMethodConfigurator(API);

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> direct() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">Exception</span> {
        <span style="color:#777">// ... do your requests</span>
    }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_ssl">SSL</h5>
<div class="paragraph">
<p>For tests using SSL based services, you will need to use <code>activeSsl()</code> on the <code>JUnit4HttpApi</code> rule.</p>
</div>
<div class="paragraph">
<p>If you need to access the server ssl socket factory you can do it from the <code>HttpApiHandler</code> (the rule):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ClassRule</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> JUnit4HttpApi API = <span style="color:#080;font-weight:bold">new</span> JUnit4HttpApi()<strong>.activeSsl()</strong>;

<span style="color:#007">@Test</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> test() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">Exception</span> {
    <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">HttpsURLConnection</span> connection = getHttpsConnection();
    connection.setSSLSocketFactory(API.getSslContext().getSocketFactory());
    <span style="color:#777">// ....</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_junit_5_4">2.3.2. JUnit 5</h4>
<div class="paragraph">
<p>JUnit 5 uses a JUnit 5 extension based on the <code>HttpApi</code> annotation you can put on your test class. You can inject
the test handler (which has some utilities for advanced cases) through <code>@HttpApiInject</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@HttpApi</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">JUnit5HttpApiTest</span> {
    <span style="color:#007">@HttpApiInject</span>
    <span style="color:#088;font-weight:bold">private</span> HttpApiHandler&lt;?&gt; handler;

    <span style="color:#007">@Test</span>
    <span style="color:#339;font-weight:bold">void</span> getProxy() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">Exception</span> {
        <span style="color:#777">// .... do your requests</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the injection is optional and the <code>@HttpApi</code> allows you to configure several behaviors of the test.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_ssl_2">SSL</h5>
<div class="paragraph">
<p>For tests using SSL based services, you will need to use <code>@HttpApi(useSsl = true)</code>.</p>
</div>
<div class="paragraph">
<p>You can access the client SSL socket factory through the api handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@HttpApi</span><strong>(useSsl = <span style="color:#069">true</span>)</strong>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyHttpsApiTest</span> {
    <span style="color:#007">@HttpApiInject</span>
    <span style="color:#088;font-weight:bold">private</span> HttpApiHandler&lt;?&gt; handler;

    <span style="color:#007">@Test</span>
    <span style="color:#339;font-weight:bold">void</span> test() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">Exception</span> {
        <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">HttpsURLConnection</span> connection = getHttpsConnection();
        connection.setSSLSocketFactory(handler.getSslContext().getSocketFactory());
        <span style="color:#777">// ....</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_capturing_mode">2.3.3. Capturing mode</h4>
<div class="paragraph">
<p>The strength of this implementation is to run a small proxy server and auto configure the JVM:
<code>http[s].proxyHost</code>, <code>http[s].proxyPort</code>, <code>HttpsURLConnection#defaultSSLSocketFactory</code> and <code>SSLContext#default</code>
are auto configured to work out of the box with the proxy.</p>
</div>
<div class="paragraph">
<p>It allows you to keep in your tests the native and real URLs. For instance this test is perfectlt valid:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">GoogleTest</span> {
    <span style="color:#007">@ClassRule</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> JUnit4HttpApi API = <span style="color:#080;font-weight:bold">new</span> JUnit4HttpApi();

    <span style="color:#007">@Rule</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">final</span> JUnit4HttpApiPerMethodConfigurator configurator = <span style="color:#080;font-weight:bold">new</span> JUnit4HttpApiPerMethodConfigurator(API);

    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> google() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">Exception</span> {
        assertEquals(<span style="color:#0a8;font-weight:bold">HttpURLConnection</span>.HTTP_OK, get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">https://google.fr?q=Talend</span><span style="color:#710">&quot;</span></span>));
    }

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">int</span> get(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span> uri) <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">Exception</span> {
        <span style="color:#777">// do the GET request, skipped for brievity</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you execute this test, it will fail with a HTTP 400 because the proxy doesn&#8217;t find the mocked response.
You can create it manually as seen in the introduction of the module but you can also set the property <code>talend.junit.http.capture</code>
to the folder where to store the captures. It must be the root folder and not the folder where the json are (ie not prefixed by <code>talend/testing/http</code> by default).</p>
</div>
<div class="paragraph">
<p>Generally you will want to use <code>src/test/resources</code>. If <code>new File("src/test/resources")</code> resolves to the valid folder when executing your test (Maven default),
then you can just set the system property to true, otherwise you need to adjust accordingly the system property value.</p>
</div>
<div class="paragraph">
<p>Once you ran the tests with this system property, the testing framework will have created the correct mock response files and you can
remove the system property. The test will still pass, using <code>google.com</code>&#8230;&#8203;even if you disconnect your machine from the internet.</p>
</div>
<div class="paragraph">
<p>The rule (extension) is doing all the work for you :).</p>
</div>
</div>
<div class="sect3">
<h4 id="_passthrough_mode">2.3.4. Passthrough mode</h4>
<div class="paragraph">
<p>Setting <code>talend.junit.http.passthrough</code> system property to <code>true</code>, the server will just be a proxy and will execute each request
to the actual server - like in capturing mode.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_beam_testing">3. Beam testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to ensure your component works in Beam the minimum to do is to try with the direct runner (if you don&#8217;t want to use spark).</p>
</div>
<div class="paragraph">
<p>Check <a href="https://beam.apache.org/contribute/testing/" class="bare">beam.apache.org/contribute/testing/</a> out for more details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multiple_environments_for_the_same_tests">4. Multiple environments for the same tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>JUnit (4 or 5) already provides some ways to parameterized tests and execute the same "test logic"
against several data. However it is not that convenient to test multiple environments.</p>
</div>
<div class="paragraph">
<p>For instance, with Beam, you can desire to test against multiple runners your code
and it requires to solve conflicts between runner dependencies, setup the correct classloaders
etc&#8230;&#8203;It is a lot of work!</p>
</div>
<div class="paragraph">
<p>To simplify such cases, the framework provides you a multi-environment support for your tests.</p>
</div>
<div class="paragraph">
<p>It is in the junit module and is usable with JUnit 4 and JUnit 5.</p>
</div>
<div class="sect2">
<h3 id="_junit_4_5">4.1. JUnit 4</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@RunWith</span>(MultiEnvironmentsRunner.class)
<span style="color:#007">@Environment</span>(Env1.class)
<span style="color:#007">@Environment</span>(Env1.class)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TheTest</span> {
    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> test1() {
        <span style="color:#777">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>MultiEnvironmentsRunner</code> will execute the test(s) for each defined environments. It means it will
run <code>test1</code> for <code>Env1</code> and <code>Env2</code> in previous example.</p>
</div>
<div class="paragraph">
<p>By default <code>JUnit4</code> runner will be used to execute the tests in one environment but you can use <code>@DelegateRunWith</code>
to use another runner.</p>
</div>
</div>
<div class="sect2">
<h3 id="_junit_5_5">4.2. JUnit 5</h3>
<div class="paragraph">
<p>JUnit 5 configuration is close to JUnit 4 one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Environment</span>(EnvironmentsExtensionTest.E1.class)
<span style="color:#007">@Environment</span>(EnvironmentsExtensionTest.E2.class)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TheTest</span> {

    <span style="color:#007">@EnvironmentalTest</span>
    <span style="color:#339;font-weight:bold">void</span> test1() {
        <span style="color:#777">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The main difference is you don&#8217;t use a runner (it doesn&#8217;t exist in JUnit 5) and you replace <code>@Test</code> by <code>@EnvironmentalTest</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
the main difference with JUnit 4 integration is that the tests are execute one after each other for all environments
instead of running all tests in each environments sequentially. It means, for instance, that <code>@BeforeAll</code> and <code>@AfterAll</code> are executed
once for all runners.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_provided_environments">4.3. Provided environments</h3>
<div class="paragraph">
<p>The provided environment setup the contextual classloader to load the related runner of Apache Beam.</p>
</div>
<div class="paragraph">
<p>Package: <code>org.talend.sdk.component.junit.environment.builtin.beam</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the configuration is read from system properties, environment variables, &#8230;&#8203;.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all table-striped table-hover table-ordered">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DirectRunnerEnvironment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct runner</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FlinkRunnerEnvironment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flink</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flink runner</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SparkRunnerEnvironment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spark</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spark runner</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_configuring_environments">4.4. Configuring environments</h3>
<div class="paragraph">
<p>If the environment extends <code>BaseEnvironmentProvider</code> and therefore defines an environment name - which is the case of the default ones, you can use <code>EnvironmentConfiguration</code>
to customize the system properties used for that environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Environment</span>(DirectRunnerEnvironment.class)
<span style="color:#007">@EnvironmentConfiguration</span>(
    environment = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Direct</span><span style="color:#710">&quot;</span></span>,
    systemProperties = <span style="color:#007">@EnvironmentConfiguration</span>.Property(key = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">beamTestPipelineOptions</span><span style="color:#710">&quot;</span></span>, value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">...</span><span style="color:#710">&quot;</span></span>))

<span style="color:#007">@Environment</span>(SparkRunnerEnvironment.class)
<span style="color:#007">@EnvironmentConfiguration</span>(
    environment = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Spark</span><span style="color:#710">&quot;</span></span>,
    systemProperties = <span style="color:#007">@EnvironmentConfiguration</span>.Property(key = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">beamTestPipelineOptions</span><span style="color:#710">&quot;</span></span>, value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">...</span><span style="color:#710">&quot;</span></span>))

<span style="color:#007">@Environment</span>(FlinkRunnerEnvironment.class)
<span style="color:#007">@EnvironmentConfiguration</span>(
    environment = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Flink</span><span style="color:#710">&quot;</span></span>,
    systemProperties = <span style="color:#007">@EnvironmentConfiguration</span>.Property(key = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">beamTestPipelineOptions</span><span style="color:#710">&quot;</span></span>, value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">...</span><span style="color:#710">&quot;</span></span>))
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyBeamTest</span> {

    <span style="color:#007">@EnvironmentalTest</span>
    <span style="color:#339;font-weight:bold">void</span> execute() {
        <span style="color:#777">// run some pipeline</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
if you set the system property <code>&lt;environment name&gt;.skip=true</code> then the environment related executions will be skipped.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_secrets_passwords_and_maven">5. Secrets/Passwords and Maven</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you desire you can reuse your Maven <code>settings.xml</code> servers - including the encrypted ones.
<code>org.talend.sdk.component.maven.MavenDecrypter</code> will give you the ability to find a server <code>username</code>/<code>password</code> from
a server identifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">final</span> MavenDecrypter decrypter = <span style="color:#080;font-weight:bold">new</span> MavenDecrypter();
<span style="color:#088;font-weight:bold">final</span> Server decrypted = decrypter.find(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my-test-server</span><span style="color:#710">&quot;</span></span>);
<span style="color:#777">// decrypted.getUsername();</span>
<span style="color:#777">// decrypted.getPassword();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is very useful to not store secrets and test on real systems on a continuous integration platform.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
even if you don&#8217;t use maven on the platform you can generate the <code>settings.xml</code> and <code>settings-security.xml</code> files
to use that feature. See <a href="https://maven.apache.org/guides/mini/guide-encryption.html" class="bare">maven.apache.org/guides/mini/guide-encryption.html</a> for more details.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generating_data">6. Generating data?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Several data generator exists if you want to populate objects with a semantic a bit more evolved than a plain random string
like <code>commons-lang3</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/Codearte/jfairy" class="bare">github.com/Codearte/jfairy</a></p>
</li>
<li>
<p><a href="https://github.com/DiUS/java-faker" class="bare">github.com/DiUS/java-faker</a></p>
</li>
<li>
<p><a href="https://github.com/andygibson/datafactory" class="bare">github.com/andygibson/datafactory</a></p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A bit more advanced, these ones allow to bind directly generic data on a model - but data quality is not always there:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devopsfolks/podam" class="bare">github.com/devopsfolks/podam</a></p>
</li>
<li>
<p><a href="https://github.com/benas/random-beans" class="bare">github.com/benas/random-beans</a></p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note there are two main kind of implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the one using a <em>pattern</em> and random generated data</p>
</li>
<li>
<p>a set of precomputed data extrapolated to create new values</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Check against your use case to know which one is the best.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
an interesting alternative to data generation is to import <em>real</em> data and use Talend Studio to sanitize the data (remove sensitive information replacing them by generated data or anonymized data)
and just inject that file into the system.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are using JUnit 5, you can have a look to <a href="https://glytching.github.io/junit-extensions/randomBeans" class="bare">glytching.github.io/junit-extensions/randomBeans</a>
which is pretty good on that topic.</p>
</div>
</div>
</div>
            </div>
            
        </div>
    </div>


    <footer>
        <div class="row">
          <div class="col-lg-12">

            <ul class="list-unstyled">
              <li class="pull-right"><a href="#top">Back to top</a></li>
            </ul>
          </div>
        </div>
    </footer>
    </div>

    <script src="js/jquery-1.10.2.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap.js"></script>
  </body>
</html>

